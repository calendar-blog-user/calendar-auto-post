name: Daily Calendar Post

on:
  schedule:
    # 毎日日本時間 7:00 に実行（UTC   22:00）
    - cron: '0 22 * * *'
  workflow_dispatch:  # 手動実行を有効化

jobs:
  post-calendar:
    runs-on: ubuntu-latest
    
    steps:
- name: Checkout repository
  uses: actions/checkout@v3
  
- name: Set up Python
  uses: actions/setup-python@v4
  with:
    python-version: '3.10'
    
- name: Install dependencies
  run: |
    python -m pip install --upgrade pip
    if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
    # 念のため ephem が入ったか確認
    pip list | grep ephem
    
- name: Run Calendar Bot
  env:
    BLOG_ID: ${{ secrets.BLOG_ID }}
    GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
    # Google API認証情報
    GOOGLE_CREDENTIALS_JSON: ${{ secrets.GOOGLE_CREDENTIALS_JSON }}
    # トークン認証の場合
    GOOGLE_TOKEN: ${{ secrets.GOOGLE_TOKEN }} 
    GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
  run: |
    # ログに合わせてファイル名を calendar_post.py にしています
    python calendar_post.py

          retention-days: 7
