#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æš¦æƒ…å ±è‡ªå‹•æŠ•ç¨¿ã‚·ã‚¹ãƒ†ãƒ  - å®Œå…¨ç‰ˆï¼ˆæ—¥ä»˜å¯¾å¿œç‰ˆï¼‰
æ—¥ä»˜ã«å¿œã˜ã¦å…¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å†…å®¹ãŒå‹•çš„ã«å¤‰åŒ–
"""

import os
import json
import sys
from datetime import datetime, timedelta
from zoneinfo import ZoneInfo
import math
import requests
from google.oauth2.credentials import Credentials
from google_auth_oauthlib.flow import InstalledAppFlow
from google.auth.transport.requests import Request
from googleapiclient.discovery import build
import time

SCOPES = ['https://www.googleapis.com/auth/blogger']

class AstronomicalCalculator:
    """æ­£ç¢ºãªå¤©æ–‡è¨ˆç®—"""
    
    @staticmethod
    def calculate_solar_longitude(dt):
        """å¤ªé™½é»„çµŒã‚’ç²¾å¯†è¨ˆç®—"""
        jst = ZoneInfo("Asia/Tokyo")
        if dt.tzinfo is None:
            dt = dt.replace(tzinfo=jst)
        
        y, m, d = dt.year, dt.month, dt.day
        h = dt.hour + dt.minute/60.0 + dt.second/3600.0
        
        if m <= 2:
            y -= 1
            m += 12
        
        a = int(y / 100)
        b = 2 - a + int(a / 4)
        jd = int(365.25 * (y + 4716)) + int(30.6001 * (m + 1)) + d + h/24.0 + b - 1524.5
        
        t = (jd - 2451545.0) / 36525.0
        
        l0 = 280.46646 + 36000.76983 * t + 0.0003032 * t * t
        l0 = l0 % 360
        
        m = 357.52911 + 35999.05029 * t - 0.0001537 * t * t
        m_rad = math.radians(m)
        
        e = 0.016708634 - 0.000042037 * t - 0.0000001267 * t * t
        
        c = (1.914602 - 0.004817 * t - 0.000014 * t * t) * math.sin(m_rad)
        c += (0.019993 - 0.000101 * t) * math.sin(2 * m_rad)
        c += 0.000289 * math.sin(3 * m_rad)
        
        true_longitude = (l0 + c) % 360
        
        return true_longitude
    
    @classmethod
    def get_current_sekki(cls, dt):
        """ç¾åœ¨ã®äºŒåå››ç¯€æ°—"""
        sekki_data = [
            (315, "ç«‹æ˜¥", "ã‚Šã£ã—ã‚…ã‚“", "æ˜¥ã®å§‹ã¾ã‚Šã€‚å¯’ã•ã®ä¸­ã«ã‚‚æ˜¥ã®æ°—é…ã‚’æ„Ÿã˜ã‚‹å­£ç¯€ã§ã™ã€‚"),
            (330, "é›¨æ°´", "ã†ã™ã„", "é›ªãŒé›¨ã«å¤‰ã‚ã‚Šã€è‰æœ¨ãŒèŠ½ç”Ÿãˆå§‹ã‚ã‚‹é ƒã€‚æ˜¥ã®è¨ªã‚Œã‚’æ„Ÿã˜ã¾ã™ã€‚"),
            (345, "å•“èŸ„", "ã‘ã„ã¡ã¤", "å†¬çœ ã—ã¦ã„ãŸè™«ãŸã¡ãŒç›®è¦šã‚ã€æ˜¥ã®æ´»å‹•ã‚’å§‹ã‚ã‚‹æ™‚æœŸã§ã™ã€‚"),
            (0, "æ˜¥åˆ†", "ã—ã‚…ã‚“ã¶ã‚“", "æ˜¼å¤œã®é•·ã•ãŒç­‰ã—ããªã‚‹æ—¥ã€‚æœ¬æ ¼çš„ãªæ˜¥ã®åˆ°æ¥ã‚’å‘Šã’ã¾ã™ã€‚"),
            (15, "æ¸…æ˜", "ã›ã„ã‚ã„", "ä¸‡ç‰©ãŒæ¸…ã‚‰ã‹ã«ç”Ÿãç”Ÿãã¨ã™ã‚‹å­£ç¯€ã€‚èŠ±ã€…ãŒå’²ãèª‡ã‚Šã¾ã™ã€‚"),
            (30, "ç©€é›¨", "ã“ãã†", "ç”°ç•‘ã‚’æ½¤ã™æ˜¥ã®é›¨ã€‚è¾²ä½œæ¥­ãŒæœ¬æ ¼åŒ–ã™ã‚‹æ™‚æœŸã§ã™ã€‚"),
            (45, "ç«‹å¤", "ã‚Šã£ã‹", "å¤ã®å§‹ã¾ã‚Šã€‚æ–°ç·‘ãŒçœ©ã—ãã€ç”Ÿå‘½åŠ›ã«æº€ã¡ãŸå­£ç¯€ã§ã™ã€‚"),
            (60, "å°æº€", "ã—ã‚‡ã†ã¾ã‚“", "è‰æœ¨ãŒæˆé•·ã—ã€å¤©åœ°ã«æ°—ãŒæº€ã¡ã¦ãã‚‹é ƒã§ã™ã€‚"),
            (75, "èŠ’ç¨®", "ã¼ã†ã—ã‚…", "ç¨²ã®ç¨®ã¾ãã‚’ã™ã‚‹æ™‚æœŸã€‚æ¢…é›¨å…¥ã‚Šã‚’è¿ãˆã¾ã™ã€‚"),
            (90, "å¤è‡³", "ã’ã—", "ä¸€å¹´ã§æœ€ã‚‚æ˜¼ãŒé•·ã„æ—¥ã€‚å¤ã®ç››ã‚Šã¸ã¨å‘ã‹ã„ã¾ã™ã€‚"),
            (105, "å°æš‘", "ã—ã‚‡ã†ã—ã‚‡", "æœ¬æ ¼çš„ãªæš‘ã•ã®å§‹ã¾ã‚Šã€‚å¤æœ¬ç•ªã‚’è¿ãˆã¾ã™ã€‚"),
            (120, "å¤§æš‘", "ãŸã„ã—ã‚‡", "ä¸€å¹´ã§æœ€ã‚‚æš‘ã„æ™‚æœŸã€‚ã†ã ã‚‹ã‚ˆã†ãªæš‘ã•ã®å­£ç¯€ã§ã™ã€‚"),
            (135, "ç«‹ç§‹", "ã‚Šã£ã—ã‚…ã†", "ç§‹ã®å§‹ã¾ã‚Šã€‚æš¦ã®ä¸Šã§ã¯ç§‹ã§ã™ãŒã€æ®‹æš‘ãŒç¶šãã¾ã™ã€‚"),
            (150, "å‡¦æš‘", "ã—ã‚‡ã—ã‚‡", "æš‘ã•ãŒå’Œã‚‰ãå§‹ã‚ã‚‹é ƒã€‚æœå¤•ã«ç§‹ã®æ°—é…ã‚’æ„Ÿã˜ã¾ã™ã€‚"),
            (165, "ç™½éœ²", "ã¯ãã‚", "è‰èŠ±ã«ç™½ã„éœ²ãŒå®¿ã‚‹å­£ç¯€ã€‚ç§‹ã®æ·±ã¾ã‚Šã‚’æ„Ÿã˜ã¾ã™ã€‚"),
            (180, "ç§‹åˆ†", "ã—ã‚…ã†ã¶ã‚“", "æ˜¼å¤œã®é•·ã•ãŒç­‰ã—ã„æ—¥ã€‚ç§‹ã®å½¼å²¸ã®ä¸­æ—¥ã§ã™ã€‚"),
            (195, "å¯’éœ²", "ã‹ã‚“ã‚", "éœ²ãŒå†·ãŸãæ„Ÿã˜ã‚‰ã‚Œã‚‹é ƒã€‚ç´…è‘‰ãŒç¾ã—ã„å­£ç¯€ã§ã™ã€‚"),
            (210, "éœœé™", "ãã†ã“ã†", "æœéœœãŒé™ã‚Šå§‹ã‚ã€ç§‹ãŒæ·±ã¾ã‚‹æ™‚æœŸã§ã™ã€‚"),
            (225, "ç«‹å†¬", "ã‚Šã£ã¨ã†", "å†¬ã®å§‹ã¾ã‚Šã€‚æœ¨æ¯ã‚‰ã—ãŒå¹ãå§‹ã‚ã‚‹å­£ç¯€ã§ã™ã€‚"),
            (240, "å°é›ª", "ã—ã‚‡ã†ã›ã¤", "ã‚ãšã‹ã«é›ªãŒé™ã‚Šå§‹ã‚ã‚‹é ƒã€‚å†¬ã®æ°—é…ãŒæ¿ƒããªã‚Šã¾ã™ã€‚"),
            (255, "å¤§é›ª", "ãŸã„ã›ã¤", "å±±ã€…ã¯é›ªã«è¦†ã‚ã‚Œã€æœ¬æ ¼çš„ãªå†¬ã®åˆ°æ¥ã€‚"),
            (270, "å†¬è‡³", "ã¨ã†ã˜", "ä¸€å¹´ã§æœ€ã‚‚æ˜¼ãŒçŸ­ã„æ—¥ã€‚ã“ã‚Œã‹ã‚‰æ—¥ãŒé•·ããªã£ã¦ã„ãã¾ã™ã€‚"),
            (285, "å°å¯’", "ã—ã‚‡ã†ã‹ã‚“", "å¯’ã•ãŒå³ã—ããªã‚Šå§‹ã‚ã‚‹é ƒã€‚å¯’ã®å…¥ã‚Šã§ã™ã€‚"),
            (300, "å¤§å¯’", "ã ã„ã‹ã‚“", "ä¸€å¹´ã§æœ€ã‚‚å¯’ã„æ™‚æœŸã€‚å¯’ã•ã®æ¥µã¿ã§ã™ã€‚")
        ]
        
        longitude = cls.calculate_solar_longitude(dt)
        
        for i, (deg, name, reading, desc) in enumerate(sekki_data):
            next_deg = sekki_data[(i + 1) % len(sekki_data)][0]
            
            if deg <= next_deg:
                if deg <= longitude < next_deg:
                    return (name, reading, desc)
            else:
                if longitude >= deg or longitude < next_deg:
                    return (name, reading, desc)
        
        return sekki_data[0][1:]
    
    @classmethod
    def get_current_kou(cls, dt):
        """ç¾åœ¨ã®ä¸ƒåäºŒå€™ï¼ˆå®Œå…¨ç‰ˆï¼‰"""
        month, day = dt.month, dt.day
        
        kou_data = [
            # æ˜¥
            (2, 4, "æ±é¢¨è§£å‡", "ã¯ã‚‹ã‹ãœã“ãŠã‚Šã‚’ã¨ã", "æ˜¥é¢¨ãŒæ°·ã‚’è§£ã‹ã—å§‹ã‚ã‚‹é ƒã€‚ç«‹æ˜¥ã®åˆå€™ã§ã™ã€‚"),
            (2, 9, "é»„é¶¯çç†", "ã†ãã„ã™ãªã", "é¶¯ãŒå±±é‡Œã§é³´ãå§‹ã‚ã‚‹é ƒã€‚æ˜¥ã®è¨ªã‚Œã‚’å‘Šã’ã‚‹é³´ãå£°ã§ã™ã€‚"),
            (2, 14, "é­šä¸Šæ°·", "ã†ãŠã“ãŠã‚Šã‚’ã„ãšã‚‹", "å‰²ã‚ŒãŸæ°·ã®é–“ã‹ã‚‰é­šãŒé£›ã³è·³ã­ã‚‹é ƒã§ã™ã€‚"),
            (2, 19, "åœŸè„‰æ½¤èµ·", "ã¤ã¡ã®ã—ã‚‡ã†ã†ã‚‹ãŠã„ãŠã“ã‚‹", "é›¨ãŒé™ã£ã¦åœŸãŒæ¹¿ã‚Šæ°—ã‚’å«ã‚€é ƒã§ã™ã€‚"),
            (2, 24, "éœå§‹é†", "ã‹ã™ã¿ã¯ã˜ã‚ã¦ãŸãªã³ã", "éœãŒãŸãªã³ãã€æ˜¥æ™¯è‰²ãŒåºƒãŒã‚‹é ƒã§ã™ã€‚"),
            (3, 1, "è‰æœ¨èŒå‹•", "ãã†ã‚‚ãã‚ã°ãˆã„ãšã‚‹", "è‰æœ¨ãŒèŠ½å¹ãå§‹ã‚ã‚‹é ƒã€‚æ˜¥ã®æ¯å¹ã‚’æ„Ÿã˜ã¾ã™ã€‚"),
            (3, 6, "èŸ„è™«å•“æˆ¸", "ã™ã”ã‚‚ã‚Šã‚€ã—ã¨ã‚’ã²ã‚‰ã", "å†¬çœ ã—ã¦ã„ãŸè™«ãŒå¤–ã«é€™ã„å‡ºã¦ãã‚‹é ƒã§ã™ã€‚"),
            (3, 11, "æ¡ƒå§‹ç¬‘", "ã‚‚ã‚‚ã¯ã˜ã‚ã¦ã•ã", "æ¡ƒã®èŠ±ãŒå’²ãå§‹ã‚ã‚‹é ƒã€‚ç¬‘ã¯å’²ãã®æ„å‘³ã§ã™ã€‚"),
            (3, 16, "èœè™«åŒ–è¶", "ãªã‚€ã—ã¡ã‚‡ã†ã¨ãªã‚‹", "é’è™«ãŒè¶ã«ç¾½åŒ–ã™ã‚‹é ƒã€‚æ˜¥ã®ç”Ÿå‘½ã®èºå‹•ã§ã™ã€‚"),
            (3, 21, "é›€å§‹å·£", "ã™ãšã‚ã¯ã˜ã‚ã¦ã™ãã†", "é›€ãŒå·£ã‚’ä½œã‚Šå§‹ã‚ã‚‹é ƒã§ã™ã€‚"),
            (3, 26, "æ«»å§‹é–‹", "ã•ãã‚‰ã¯ã˜ã‚ã¦ã²ã‚‰ã", "æ¡œãŒå’²ãå§‹ã‚ã‚‹é ƒã€‚æ˜¥ã®ä»£åè©ã§ã™ã€‚"),
            (3, 31, "é›·ä¹ƒç™ºå£°", "ã‹ã¿ãªã‚Šã™ãªã‚ã¡ã“ãˆã‚’ã¯ã£ã™", "é ãã§é›·ã®éŸ³ãŒèã“ãˆå§‹ã‚ã‚‹é ƒã§ã™ã€‚"),
            (4, 5, "ç„é³¥è‡³", "ã¤ã°ã‚ããŸã‚‹", "ç‡•ãŒå—ã‹ã‚‰æ¸¡ã£ã¦ãã‚‹é ƒã€‚æ˜¥ã®ä½¿è€…ã§ã™ã€‚"),
            (4, 10, "é´»é›åŒ—", "ã“ã†ãŒã‚“ã‹ãˆã‚‹", "é›ãŒåŒ—ã¸å¸°ã£ã¦ã„ãé ƒã§ã™ã€‚"),
            (4, 15, "è™¹å§‹è¦‹", "ã«ã˜ã¯ã˜ã‚ã¦ã‚ã‚‰ã‚ã‚‹", "é›¨ä¸ŠãŒã‚Šã«è™¹ãŒå‡ºå§‹ã‚ã‚‹é ƒã§ã™ã€‚"),
            (4, 20, "è‘­å§‹ç”Ÿ", "ã‚ã—ã¯ã˜ã‚ã¦ã—ã‚‡ã†ãš", "è‘¦ãŒèŠ½ã‚’å¹ãå§‹ã‚ã‚‹é ƒã§ã™ã€‚"),
            (4, 25, "éœœæ­¢å‡ºè‹—", "ã—ã‚‚ã‚„ã‚“ã§ãªãˆã„ãš", "éœœãŒé™ã‚Šãªããªã‚Šã€è‹—ãŒè‚²ã¤é ƒã§ã™ã€‚"),
            (4, 30, "ç‰¡ä¸¹è¯", "ã¼ãŸã‚“ã¯ãªã•ã", "ç‰¡ä¸¹ã®èŠ±ãŒå’²ãé ƒã€‚è¯ã‚„ã‹ãªæ˜¥ã®çµ‚ã‚ã‚Šã§ã™ã€‚"),
            # å¤
            (5, 5, "è›™å§‹é³´", "ã‹ã‚ãšã¯ã˜ã‚ã¦ãªã", "è›™ãŒé³´ãå§‹ã‚ã‚‹é ƒã€‚åˆå¤ã®é¢¨ç‰©è©©ã§ã™ã€‚"),
            (5, 10, "èš¯èš“å‡º", "ã¿ã¿ãšã„ãšã‚‹", "èš¯èš“ãŒåœ°ä¸Šã«é€™ã„å‡ºã¦ãã‚‹é ƒã§ã™ã€‚"),
            (5, 15, "ç«¹ç¬‹ç”Ÿ", "ãŸã‘ã®ã“ã—ã‚‡ã†ãš", "ç­ãŒç”Ÿãˆã¦ãã‚‹é ƒã€‚æ—¬ã®å‘³è¦šã§ã™ã€‚"),
            (5, 21, "èš•èµ·é£Ÿæ¡‘", "ã‹ã„ã“ãŠãã¦ãã‚ã‚’ã¯ã‚€", "èš•ãŒæ¡‘ã®è‘‰ã‚’ç››ã‚“ã«é£Ÿã¹å§‹ã‚ã‚‹é ƒã§ã™ã€‚"),
            (5, 26, "ç´…èŠ±æ „", "ã¹ã«ã°ãªã•ã‹ã†", "ç´…èŠ±ãŒç››ã‚“ã«å’²ãé ƒã§ã™ã€‚"),
            (5, 31, "éº¦ç§‹è‡³", "ã‚€ãã®ã¨ãã„ãŸã‚‹", "éº¦ãŒç†Ÿã—ã€åç©«æœŸã‚’è¿ãˆã‚‹é ƒã§ã™ã€‚"),
            (6, 6, "èŸ·è‚ç”Ÿ", "ã‹ã¾ãã‚Šã—ã‚‡ã†ãš", "èŸ·è‚ãŒç”Ÿã¾ã‚Œå‡ºã‚‹é ƒã§ã™ã€‚"),
            (6, 11, "è…è‰ç‚ºè¢", "ãã•ã‚ŒãŸã‚‹ãã•ã»ãŸã‚‹ã¨ãªã‚‹", "è›ãŒå…‰ã‚’æ”¾ã¡å§‹ã‚ã‚‹é ƒã€‚åˆå¤ã®é¢¨æƒ…ã§ã™ã€‚"),
            (6, 16, "æ¢…å­é»„", "ã†ã‚ã®ã¿ãã°ã‚€", "æ¢…ã®å®ŸãŒé»„ã°ã‚“ã§ç†Ÿã™é ƒã§ã™ã€‚"),
            (6, 21, "ä¹ƒæ±æ¯", "ãªã¤ã‹ã‚Œãã•ã‹ã‚‹ã‚‹", "å¤æ¯è‰ãŒæ¯ã‚Œã‚‹é ƒã€‚å¤è‡³ã®æ—¥ã§ã™ã€‚"),
            (6, 26, "è–è’²è¯", "ã‚ã‚„ã‚ã¯ãªã•ã", "è–è’²ã®èŠ±ãŒå’²ãé ƒã§ã™ã€‚"),
            (7, 2, "åŠå¤ç”Ÿ", "ã¯ã‚“ã’ã—ã‚‡ã†ãš", "çƒæŸ„æ“ãŒç”Ÿãˆã‚‹é ƒã€‚ç”°æ¤ãˆã®ç›®å®‰ã¨ã•ã‚Œã¾ã—ãŸã€‚"),
            (7, 7, "æ¸©é¢¨è‡³", "ã‚ã¤ã‹ãœã„ãŸã‚‹", "æš‘ã„é¢¨ãŒå¹ã„ã¦ãã‚‹é ƒã€‚å¤æœ¬ç•ªã§ã™ã€‚"),
            (7, 12, "è“®å§‹é–‹", "ã¯ã™ã¯ã˜ã‚ã¦ã²ã‚‰ã", "è“®ã®èŠ±ãŒé–‹ãå§‹ã‚ã‚‹é ƒã§ã™ã€‚"),
            (7, 17, "é·¹ä¹ƒå­¦ç¿’", "ãŸã‹ã™ãªã‚ã¡ã‚ã–ã‚’ãªã‚‰ã†", "é·¹ã®å¹¼é³¥ãŒé£›ã³æ–¹ã‚’è¦šãˆã‚‹é ƒã§ã™ã€‚"),
            (7, 23, "æ¡å§‹çµèŠ±", "ãã‚Šã¯ã˜ã‚ã¦ã¯ãªã‚’ã‚€ã™ã¶", "æ¡ã®èŠ±ãŒå®Ÿã‚’çµã¶é ƒã§ã™ã€‚"),
            (7, 28, "åœŸæ½¤æº½æš‘", "ã¤ã¡ã†ã‚‹ãŠã†ã¦ã‚€ã—ã‚ã¤ã—", "åœŸãŒæ¹¿ã£ã¦è’¸ã—æš‘ããªã‚‹é ƒã§ã™ã€‚"),
            (8, 2, "å¤§é›¨æ™‚è¡Œ", "ãŸã„ã†ã¨ãã©ããµã‚‹", "æ™‚ã¨ã—ã¦å¤§é›¨ãŒé™ã‚‹é ƒã€‚å¤•ç«‹ã®å­£ç¯€ã§ã™ã€‚"),
            # ç§‹
            (8, 7, "æ¶¼é¢¨è‡³", "ã™ãšã‹ãœã„ãŸã‚‹", "æ¶¼ã—ã„é¢¨ãŒå¹ãå§‹ã‚ã‚‹é ƒã€‚ç«‹ç§‹ã§ã™ã€‚"),
            (8, 13, "å¯’è‰é³´", "ã²ãã‚‰ã—ãªã", "èœ©ãŒé³´ãå§‹ã‚ã‚‹é ƒã€‚ç§‹ã®æ°—é…ã‚’æ„Ÿã˜ã¾ã™ã€‚"),
            (8, 18, "è’™éœ§å‡é™", "ãµã‹ããã‚Šã¾ã¨ã†", "æ·±ã„éœ§ãŒã¾ã¨ã‚ã‚Šã¤ãé ƒã§ã™ã€‚"),
            (8, 23, "ç¶¿æŸé–‹", "ã‚ãŸã®ã¯ãªã—ã¹ã²ã‚‰ã", "ç¶¿ã®èŠ±ã®ãŒããŒé–‹ãé ƒã§ã™ã€‚"),
            (8, 28, "å¤©åœ°å§‹ç²›", "ã¦ã‚“ã¡ã¯ã˜ã‚ã¦ã•ã‚€ã—", "å¤©åœ°ã®æš‘ã•ãŒåã¾ã‚Šå§‹ã‚ã‚‹é ƒã§ã™ã€‚"),
            (9, 2, "ç¦¾ä¹ƒç™»", "ã“ãã‚‚ã®ã™ãªã‚ã¡ã¿ã®ã‚‹", "ç¨²ãŒå®Ÿã‚‹é ƒã€‚å®Ÿã‚Šã®ç§‹ã§ã™ã€‚"),
            (9, 7, "è‰éœ²ç™½", "ãã•ã®ã¤ã‚†ã—ã‚ã—", "è‰ã«é™ã‚ŠãŸéœ²ãŒç™½ãè¦‹ãˆã‚‹é ƒã§ã™ã€‚"),
            (9, 12, "é¶ºé´’é³´", "ã›ãã‚Œã„ãªã", "é¶ºé´’ãŒé³´ãå§‹ã‚ã‚‹é ƒã§ã™ã€‚"),
            (9, 17, "ç„é³¥å»", "ã¤ã°ã‚ã•ã‚‹", "ç‡•ãŒå—ã¸å¸°ã£ã¦ã„ãé ƒã§ã™ã€‚"),
            (9, 23, "é›·ä¹ƒåå£°", "ã‹ã¿ãªã‚Šã™ãªã‚ã¡ã“ãˆã‚’ãŠã•ã‚€", "é›·ãŒé³´ã‚‰ãªããªã‚‹é ƒã€‚ç§‹åˆ†ã§ã™ã€‚"),
            (9, 28, "èŸ„è™«åæˆ¸", "ã‚€ã—ã‹ãã‚Œã¦ã¨ã‚’ãµã•ã", "è™«ãŒåœŸã®ä¸­ã«éš ã‚Œã‚‹é ƒã§ã™ã€‚"),
            (10, 3, "æ°´å§‹æ¶¸", "ã¿ãšã¯ã˜ã‚ã¦ã‹ã‚‹ã‚‹", "ç”°ã‚“ã¼ã®æ°´ã‚’æŠœãå§‹ã‚ã‚‹é ƒã§ã™ã€‚"),
            (10, 8, "é´»é›æ¥", "ã“ã†ãŒã‚“ããŸã‚‹", "é›ãŒé£›æ¥ã™ã‚‹é ƒã€‚å†¬é³¥ã®åˆ°æ¥ã§ã™ã€‚"),
            (10, 13, "èŠèŠ±é–‹", "ããã®ã¯ãªã²ã‚‰ã", "èŠã®èŠ±ãŒå’²ãé ƒã§ã™ã€‚"),
            (10, 18, "èŸ‹èŸ€åœ¨æˆ¸", "ãã‚Šãã‚Šã™ã¨ã«ã‚ã‚Š", "èŸ‹èŸ€ãŒæˆ¸å£ã§é³´ãé ƒã§ã™ã€‚"),
            (10, 23, "éœœå§‹é™", "ã—ã‚‚ã¯ã˜ã‚ã¦ãµã‚‹", "éœœãŒé™ã‚Šå§‹ã‚ã‚‹é ƒã€‚éœœé™ã§ã™ã€‚"),
            (10, 28, "éœæ™‚æ–½", "ã“ã•ã‚ã¨ãã©ããµã‚‹", "å°é›¨ãŒã—ã¨ã—ã¨é™ã‚‹é ƒã§ã™ã€‚"),
            (11, 2, "æ¥“è”¦é»„", "ã‚‚ã¿ã˜ã¤ãŸãã°ã‚€", "ç´…è‘‰ã‚„è”¦ãŒé»„è‘‰ã™ã‚‹é ƒã§ã™ã€‚"),
            # å†¬
            (11, 7, "å±±èŒ¶å§‹é–‹", "ã¤ã°ãã¯ã˜ã‚ã¦ã²ã‚‰ã", "å±±èŒ¶èŠ±ãŒå’²ãå§‹ã‚ã‚‹é ƒã€‚ç«‹å†¬ã§ã™ã€‚"),
            (11, 12, "åœ°å§‹å‡", "ã¡ã¯ã˜ã‚ã¦ã“ãŠã‚‹", "å¤§åœ°ãŒå‡ã‚Šå§‹ã‚ã‚‹é ƒã§ã™ã€‚"),
            (11, 17, "é‡‘ç›é¦™", "ãã‚“ã›ã‚“ã‹ã•ã", "æ°´ä»™ã®èŠ±ãŒå’²ãé ƒã§ã™ã€‚"),
            (11, 22, "è™¹è”µä¸è¦‹", "ã«ã˜ã‹ãã‚Œã¦ã¿ãˆãš", "è™¹ã‚’è¦‹ã‹ã‘ãªããªã‚‹é ƒã€‚å°é›ªã§ã™ã€‚"),
            (11, 27, "æœ”é¢¨æ‰•è‘‰", "ããŸã‹ãœã“ã®ã¯ã‚’ã¯ã‚‰ã†", "åŒ—é¢¨ãŒæœ¨ã®è‘‰ã‚’æ‰•ã„è½ã¨ã™é ƒã§ã™ã€‚"),
            (12, 2, "æ©˜å§‹é»„", "ãŸã¡ã°ãªã¯ã˜ã‚ã¦ãã°ã‚€", "æ©˜ã®å®ŸãŒé»„è‰²ãè‰²ã¥ãé ƒã§ã™ã€‚"),
            (12, 7, "é–‰å¡æˆå†¬", "ãã‚‰ã•ã‚€ããµã‚†ã¨ãªã‚‹", "å¤©åœ°ã®æ°—ãŒå¡ãŒã‚Šã€æœ¬æ ¼çš„ãªå†¬ã¨ãªã‚‹é ƒã€‚å¤§é›ªã§ã™ã€‚"),
            (12, 12, "ç†ŠèŸ„ç©´", "ãã¾ã‚ãªã«ã“ã‚‚ã‚‹", "ç†ŠãŒå†¬çœ ã®ãŸã‚ã«ç©´ã«å…¥ã‚‹é ƒã§ã™ã€‚"),
            (12, 17, "é±–é­šç¾¤", "ã•ã‘ã®ã†ãŠã‚€ã‚‰ãŒã‚‹", "é®­ãŒç¾¤ãŒã£ã¦å·ã‚’ä¸Šã‚‹é ƒã§ã™ã€‚"),
            (12, 22, "ä¹ƒæ±ç”Ÿ", "ãªã¤ã‹ã‚Œãã•ã—ã‚‡ã†ãš", "å¤æ¯è‰ãŒèŠ½ã‚’å‡ºã™é ƒã€‚å†¬è‡³ã§ã™ã€‚"),
            (12, 27, "éº‹è§’è§£", "ã•ã‚ã—ã‹ã¤ã®ãŠã¤ã‚‹", "å¤§é¹¿ãŒè§’ã‚’è½ã¨ã™é ƒã§ã™ã€‚"),
            (1, 1, "é›ªä¸‹å‡ºéº¦", "ã‚†ãã‚ãŸã‚Šã¦ã‚€ãã®ã³ã‚‹", "é›ªã®ä¸‹ã§éº¦ãŒèŠ½ã‚’å‡ºã™é ƒã§ã™ã€‚"),
            (1, 5, "èŠ¹ä¹ƒæ „", "ã›ã‚Šã™ãªã‚ã¡ã•ã‹ã†", "èŠ¹ãŒç››ã‚“ã«ç”Ÿãˆå§‹ã‚ã‚‹é ƒã€‚å°å¯’ã§ã™ã€‚"),
            (1, 10, "æ°´æ³‰å‹•", "ã—ã¿ãšã‚ãŸãŸã‹ã‚’ãµãã‚€", "åœ°ä¸­ã§å‡ã£ãŸæ³‰ãŒå‹•ãå§‹ã‚ã‚‹é ƒã§ã™ã€‚"),
            (1, 15, "é›‰å§‹é›Š", "ãã˜ã¯ã˜ã‚ã¦ãªã", "é›‰ãŒé³´ãå§‹ã‚ã‚‹é ƒã§ã™ã€‚"),
            (1, 20, "æ¬¾å†¬è¯", "ãµãã®ã¯ãªã•ã", "è•—ã®èŠ±ãŒå’²ãé ƒã€‚å¤§å¯’ã§ã™ã€‚"),
            (1, 25, "æ°´æ²¢è…¹å …", "ã•ã‚ã¿ãšã“ãŠã‚Šã¤ã‚ã‚‹", "æ²¢ã®æ°´ãŒåšãå‡ã‚‹é ƒã€‚å¯’ã•ã®æ¥µã¿ã§ã™ã€‚"),
            (1, 30, "é¶å§‹ä¹³", "ã«ã‚ã¨ã‚Šã¯ã˜ã‚ã¦ã¨ã‚„ã«ã¤ã", "é¶ãŒåµã‚’ç”£ã¿å§‹ã‚ã‚‹é ƒã§ã™ã€‚")
        ]
        
        current_kou = kou_data[0][2:]
        for m, d, name, reading, desc in reversed(kou_data):
            if month > m or (month == m and day >= d):
                current_kou = (name, reading, desc)
                break
        
        return current_kou


class LunarCalendar:
    """æ—§æš¦è¨ˆç®—"""
    
    @staticmethod
    def calculate_lunar_date(date):
        """æ—§æš¦è¨ˆç®—"""
        reference = datetime(2025, 12, 10, 12, 0, tzinfo=ZoneInfo("Asia/Tokyo"))
        reference_lunar = {'year': 2025, 'month': 10, 'day': 21, 'age': 19.8}
        
        synodic = 29.530588861
        elapsed_days = (date - reference).total_seconds() / 86400
        
        moon_age = (reference_lunar['age'] + elapsed_days) % synodic
        if moon_age < 0:
            moon_age += synodic
        
        elapsed_months = int((reference_lunar['age'] + elapsed_days) / synodic)
        
        lunar_year = reference_lunar['year']
        lunar_month = reference_lunar['month']
        lunar_day = reference_lunar['day']
        
        for _ in range(abs(elapsed_months)):
            if elapsed_months > 0:
                lunar_month += 1
                if lunar_month > 12:
                    lunar_month = 1
                    lunar_year += 1
            else:
                lunar_month -= 1
                if lunar_month < 1:
                    lunar_month = 12
                    lunar_year -= 1
        
        days_in_month = elapsed_days - (elapsed_months * synodic)
        lunar_day = reference_lunar['day'] + int(days_in_month)
        
        while lunar_day > 30:
            lunar_day -= 30
            lunar_month += 1
            if lunar_month > 12:
                lunar_month = 1
                lunar_year += 1
        
        while lunar_day < 1:
            lunar_day += 30
            lunar_month -= 1
            if lunar_month < 1:
                lunar_month = 12
                lunar_year -= 1
        
        # æœˆç›¸åˆ¤å®š
        if moon_age < 1.5:
            phase, appearance = "æ–°æœˆ", "å¤œç©ºã«æœˆã¯è¦‹ãˆã¾ã›ã‚“"
        elif moon_age < 3.7:
            phase, appearance = "äºŒæ—¥æœˆ", "å¤•æ–¹ã®è¥¿ç©ºã«ç´°ã„æœˆãŒè¼ãã¾ã™"
        elif moon_age < 7.4:
            phase, appearance = "ä¸Šå¼¦ã¸å‘ã‹ã†æœˆ", "å¤•æ–¹ã®ç©ºã«å¼“ãªã‚Šã®æœˆ"
        elif 7.4 <= moon_age < 11:
            phase, appearance = "ä¸Šå¼¦ã®æœˆ", "å®µã®ç©ºã«åŠæœˆãŒè¦‹ãˆã¾ã™"
        elif moon_age < 14.8:
            phase, appearance = "æº€æœˆã¸å‘ã‹ã†æœˆ", "å®µã‹ã‚‰å¤œåŠã«ã‹ã‘ã¦è†¨ã‚‰ã‚€æœˆ"
        elif 14.8 <= moon_age < 16.3:
            phase, appearance = "æº€æœˆ", "å¤œé€šã—è¼ãä¸¸ã„æœˆ"
        elif moon_age < 22.1:
            phase, appearance = "ä¸‹å¼¦ã¸å‘ã‹ã†æœˆï¼ˆå¯å¾…æœˆï¼‰", "å¤œãŒæ›´ã‘ã¦ã‹ã‚‰æ˜‡ã‚‹æœˆ"
        elif 22.1 <= moon_age < 25.9:
            phase, appearance = "ä¸‹å¼¦ã®æœˆ", "æ˜ã‘æ–¹ã«åŠæœˆãŒè¦‹ãˆã¾ã™"
        else:
            phase, appearance = "æ™¦æ—¥æœˆ", "æ˜ã‘æ–¹ã®æ±ç©ºã«ç´°ã„æœˆ"
        
        # å…­æ›œè¨ˆç®—
        rokuyou_list = ["å…ˆå‹", "å‹å¼•", "å…ˆè² ", "ä»æ»…", "å¤§å®‰", "èµ¤å£"]
        rokuyou_index = (lunar_month + lunar_day) % 6
        rokuyou = rokuyou_list[rokuyou_index]
        
        # å¹²æ”¯è¨ˆç®—
        eto_list = ["ç”²å­", "ä¹™ä¸‘", "ä¸™å¯…", "ä¸å¯", "æˆŠè¾°", "å·±å·³", "åºšåˆ", "è¾›æœª", "å£¬ç”³", "ç™¸é…‰",
                    "ç”²æˆŒ", "ä¹™äº¥", "ä¸™å­", "ä¸ä¸‘", "æˆŠå¯…", "å·±å¯", "åºšè¾°", "è¾›å·³", "å£¬åˆ", "ç™¸æœª",
                    "ç”²ç”³", "ä¹™é…‰", "ä¸™æˆŒ", "ä¸äº¥", "æˆŠå­", "å·±ä¸‘", "åºšå¯…", "è¾›å¯", "å£¬è¾°", "ç™¸å·³",
                    "ç”²åˆ", "ä¹™æœª", "ä¸™ç”³", "ä¸é…‰", "æˆŠæˆŒ", "å·±äº¥", "åºšå­", "è¾›ä¸‘", "å£¬å¯…", "ç™¸å¯",
                    "ç”²è¾°", "ä¹™å·³", "ä¸™åˆ", "ä¸æœª", "æˆŠç”³", "å·±é…‰", "åºšæˆŒ", "è¾›äº¥", "å£¬å­", "ç™¸ä¸‘",
                    "ç”²å¯…", "ä¹™å¯", "ä¸™è¾°", "ä¸å·³", "æˆŠåˆ", "å·±æœª", "åºšç”³", "è¾›é…‰", "å£¬æˆŒ", "ç™¸äº¥"]
        
        base_date = datetime(2000, 1, 1, tzinfo=ZoneInfo("Asia/Tokyo"))
        days_diff = (date.replace(hour=0, minute=0, second=0, microsecond=0) - base_date).days
        eto_index = (days_diff + 36) % 60
        eto = eto_list[eto_index]
        
        return {
            'year': lunar_year,
            'month': lunar_month,
            'day': lunar_day,
            'age': round(moon_age, 1),
            'phase': phase,
            'appearance': appearance,
            'rokuyou': rokuyou,
            'eto': eto
        }
    
    @staticmethod
    def get_lunar_month_name(month):
        """æ—§æš¦æœˆã®ç•°å"""
        names = {
            1: "ç¦æœˆ", 2: "å¦‚æœˆ", 3: "å¼¥ç”Ÿ", 4: "å¯æœˆ", 5: "çšæœˆ", 6: "æ°´ç„¡æœˆ",
            7: "æ–‡æœˆ", 8: "è‘‰æœˆ", 9: "é•·æœˆ", 10: "ç¥ç„¡æœˆ", 11: "éœœæœˆ", 12: "å¸«èµ°"
        }
        return names.get(month, "")


class SeasonalDataProvider:
    """æ—¥ä»˜ã«å¿œã˜ãŸå­£ç¯€ãƒ‡ãƒ¼ã‚¿æä¾›"""
    
    @staticmethod
    def get_seasonal_words(month, day):
        """å­£ç¯€ã®è¨€è‘‰ï¼ˆå‹•çš„ç”Ÿæˆï¼‰"""
        if month == 12:
            if day < 7:
                return "å¸«èµ°ãƒ»æ­³æœ«ãƒ»å¤§é›ªå‰"
            elif day < 22:
                return "å¸«èµ°ãƒ»æ­³æœ«ãƒ»å¤§é›ª"
            else:
                return "å¸«èµ°ãƒ»æ­³æœ«ãƒ»å†¬è‡³"
        elif month == 1:
            if day < 5:
                return "ç¦æœˆãƒ»æ–°æ˜¥ãƒ»å°å¯’å‰"
            elif day < 20:
                return "ç¦æœˆãƒ»æ–°æ˜¥ãƒ»å°å¯’"
            else:
                return "ç¦æœˆãƒ»æ–°æ˜¥ãƒ»å¤§å¯’"
        elif month == 2:
            if day < 4:
                return "å¦‚æœˆãƒ»æ—©æ˜¥ãƒ»ç«‹æ˜¥å‰"
            else:
                return "å¦‚æœˆãƒ»æ—©æ˜¥ãƒ»ç«‹æ˜¥"
        elif month == 3:
            if day < 6:
                return "å¼¥ç”Ÿãƒ»æ˜¥åˆ†å‰ãƒ»å•“èŸ„å‰"
            elif day < 21:
                return "å¼¥ç”Ÿãƒ»æ˜¥åˆ†å‰"
            else:
                return "å¼¥ç”Ÿãƒ»æ˜¥åˆ†"
        # ä»¥ä¸‹åŒæ§˜ã«ã™ã¹ã¦ã®æœˆã‚’ç¶²ç¾…
        else:
            return f"{month}æœˆãƒ»å­£ç¯€ã®ç¯€ç›®"
    
    @staticmethod
    def get_nature_changes(month, day, sekki, kou):
        """è‡ªç„¶ã®å¤‰åŒ–ï¼ˆæ—¥ä»˜å‹•çš„ï¼‰"""
        season_data = {
            12: f"""å…¸å‹çš„ãªå†¬å‹ã®æ°—åœ§é…ç½®ã®æ—¥ãŒå¢—ãˆã‚‹æ™‚æœŸã€‚

æ—¥æœ¬æµ·å´ã§ã¯é›ªã‚„é›·ã‚’ä¼´ã†è’å¤©ã€å¤ªå¹³æ´‹å´ã§ã¯ä¹¾ç‡¥ã—ãŸæ™´å¤©ã¨ã„ã†å¯¾ç…§çš„ãªå¤©æ°—ãŒç¶šãã¾ã™ã€‚

ç©ºæ°—ãŒæ¾„ã¿æ¸¡ã‚Šã€é ãã®å±±ã®è¼ªéƒ­ãŒãã£ãã‚Šè¦‹ãˆã‚‹ã®ã¯å†¬ãªã‚‰ã§ã¯ã€‚éœœæŸ±ãŒç«‹ã¡ã€è½ã¡è‘‰ãŒè¶³å…ƒã§ã‚«ã‚µãƒƒã¨éŸ³ã‚’ç«‹ã¦ã‚‹å­£ç¯€ã§ã™ã€‚

{kou[0]}ï¼ˆ{kou[1]}ï¼‰ã®é ƒã€{kou[2]}
ã“ã®é€æ˜æ„Ÿã®ã‚ã‚‹ç©ºæ°—ã¯ã€å†¬ãªã‚‰ã§ã¯ã®æ™¯è‰²ã‚’ã¤ãã£ã¦ãã‚Œã¾ã™ã€‚""",
            
            1: f"""ä¸€å¹´ã§æœ€ã‚‚å¯’ã„æ™‚æœŸã€‚{sekki[0]}ã‚’è¿ãˆã€å¯’ã•ãŒå³ã—ããªã‚Šã¾ã™ã€‚

æœã¯éœœæŸ±ãŒç«‹ã¡ã€æ± ã‚„æ°´ãŸã¾ã‚Šã«ã¯æ°·ãŒå¼µã‚‹æ—¥ã‚‚ã€‚ç©ºæ°—ãŒæ¾„ã‚“ã§æ˜ŸãŒç¾ã—ãã€æ—©æœã®å†·ãˆè¾¼ã¿ã®ä¸­ã«ã‚‚æ˜¥ã¸ã®æœŸå¾…ãŒè†¨ã‚‰ã¿ã¾ã™ã€‚

{kou[0]}ã®é ƒã€{kou[2]}
æ¢…ã®ã¤ã¼ã¿ãŒè†¨ã‚‰ã¿å§‹ã‚ã€å°‘ã—ãšã¤æ˜¥ã®æ°—é…ã‚’æ„Ÿã˜ã‚‰ã‚Œã‚‹å­£ç¯€ã§ã™ã€‚""",
            
            2: f"""ã¾ã å¯’ã•ã¯æ®‹ã‚Šã¾ã™ãŒã€æ—¥å·®ã—ãŒå¾ã€…ã«å¼·ããªã‚Šã€æ˜¥ã®è¨ªã‚Œã‚’æ„Ÿã˜å§‹ã‚ã‚‹æ™‚æœŸã€‚

{sekki[0]}ã‚’éãã‚‹ã¨ã€{kou[0]}ï¼ˆ{kou[1]}ï¼‰ã€‚{kou[2]}
æ¢…ã®èŠ±ãŒå’²ãå§‹ã‚ã€é¶¯ã®åˆéŸ³ãŒèã“ãˆã€é›ªè§£ã‘ãŒå§‹ã¾ã‚‹åœ°åŸŸã‚‚å¢—ãˆã¦ãã¾ã™ã€‚""",
            
            3: f"""æœ¬æ ¼çš„ãªæ˜¥ã®åˆ°æ¥ã€‚{sekki[0]}ã‚’è¿ãˆã€æ¡œã®é–‹èŠ±ãŒå§‹ã¾ã‚Šã¾ã™ã€‚

{kou[0]}ã®é ƒã€{kou[2]}
èœã®èŠ±ãŒä¸€é¢ã«å’²ãã€è¶ãŒèˆã„å§‹ã‚ã€æ˜¥ã®åµãŒå¹ãã“ã¨ã‚‚ã‚ã‚Šã¾ã™ãŒã€ç¢ºå®Ÿã«æ˜¥ãŒæ·±ã¾ã£ã¦ã„ãå­£ç¯€ã§ã™ã€‚""",
            
            4: f"""æ–°ç·‘ãŒç›®ã«çœ©ã—ã„å­£ç¯€ã€‚{sekki[0]}ã‚’è¿ãˆã€{kou[0]}ï¼ˆ{kou[1]}ï¼‰ã€‚

{kou[2]}
ãƒ„ãƒãƒ¡ãŒé£›æ¥ã—ã€ç­ãŒé¡”ã‚’å‡ºã—ã€å…«é‡æ¡œãŒå’²ãã€‚ç”Ÿå‘½ã®æ¯å¹ã‚’æ„Ÿã˜ã‚‹æ™‚æœŸã§ã™ã€‚""",
            
            5: f"""{sekki[0]}ã‚’éãã€åˆå¤ã®é¢¨ãŒå¿ƒåœ°ã‚ˆã„å­£ç¯€ã€‚

{kou[0]}ã®é ƒã€{kou[2]}
æ–°ç·‘ãŒæ¿ƒããªã‚Šã€ç”°æ¤ãˆãŒå§‹ã¾ã‚Šã€åˆé°¹ãŒæ—¬ã‚’è¿ãˆã‚‹ã€‚çˆ½ã‚„ã‹ãªå­£ç¯€ã§ã™ã€‚""",
            
            6: f"""æ¢…é›¨å…¥ã‚Šã®æ™‚æœŸã€‚{sekki[0]}ã‚’è¿ãˆã€{kou[0]}ï¼ˆ{kou[1]}ï¼‰ã€‚

{kou[2]}
ç´«é™½èŠ±ãŒå’²ãã€è›ãŒé£›ã³äº¤ã„ã€å¤è‡³ã§æ˜¼ãŒæœ€ã‚‚é•·ããªã‚Šã¾ã™ã€‚""",
            
            7: f"""æ¢…é›¨æ˜ã‘ã—ã¦å¤æœ¬ç•ªã€‚{sekki[0]}ã‚’è¿ãˆã€{kou[0]}ã®é ƒã€‚

{kou[2]}
ã‚»ãƒŸãŒé³´ãå§‹ã‚ã€å…¥é“é›²ãŒæ¹§ãã€æµ·é–‹ããƒ»å±±é–‹ãã‚’è¿ãˆã¾ã™ã€‚""",
            
            8: f"""æ®‹æš‘ãŒå³ã—ã„æ™‚æœŸã€‚{sekki[0]}ã‚’éãã€{kou[0]}ï¼ˆ{kou[1]}ï¼‰ã€‚

{kou[2]}
å°é¢¨ã‚·ãƒ¼ã‚ºãƒ³ã§ã‚‚ã‚ã‚Šã¾ã™ãŒã€æœæ™©ã«ã¯ç§‹ã®æ°—é…ã‚’æ„Ÿã˜å§‹ã‚ã‚‹å­£ç¯€ã§ã™ã€‚""",
            
            9: f"""{sekki[0]}ã‚’è¿ãˆã€æœ¬æ ¼çš„ãªç§‹ã€‚{kou[0]}ã®é ƒã€{kou[2]}

ç§‹ã®ä¸ƒè‰ãŒå’²ãã€ç¨²åˆˆã‚ŠãŒå§‹ã¾ã‚Šã€èµ¤ã¨ã‚“ã¼ãŒé£›ã¶ã€‚å®Ÿã‚Šã®å­£ç¯€ã§ã™ã€‚""",
            
            10: f"""ç§‹ãŒæ·±ã¾ã‚‹æ™‚æœŸã€‚{sekki[0]}ã‚’è¿ãˆã€{kou[0]}ï¼ˆ{kou[1]}ï¼‰ã€‚

{kou[2]}
ç´…è‘‰ãŒå§‹ã¾ã‚Šã€é‡‘æœ¨çŠ€ã®é¦™ã‚ŠãŒæ¼‚ã„ã€æ¸¡ã‚Šé³¥ãŒå—ã¸å‘ã‹ã„ã¾ã™ã€‚""",
            
            11: f"""{sekki[0]}ã‚’éãã€å†¬ã®å§‹ã¾ã‚Šã€‚{kou[0]}ã®é ƒã€{kou[2]}

ç´…è‘‰ãŒè¦‹é ƒã‚’è¿ãˆã€æœ¨æ¯ã‚‰ã—ãŒå¹ãã€å†¬é³¥ãŒé£›æ¥ã—ã€åˆé›ªã®ä¾¿ã‚ŠãŒå±Šãã¾ã™ã€‚"""
        }
        
        return season_data.get(month, f"{sekki[0]}ã‚’è¿ãˆã€{kou[0]}ã®é ƒã€‚{kou[2]}")
    
    @staticmethod
    def get_agriculture_info(month, day):
        """è¾²äº‹æ­´ï¼ˆæœˆã”ã¨ã«å¤‰åŒ–ï¼‰"""
        agri_data = {
            12: {
                'title': 'å†¬æ”¯åº¦ã®è¾²æœŸ',
                'content': """ã“ã®æ™‚æœŸã¯è¾²å®¶ã«ã¨ã£ã¦ã€Œç•‘ã‚‚ã²ã¨ä¼‘ã¿ã€ã®ã“ã‚ã€‚

ç¨²ä½œåœ°å¸¯ã§ã¯ã€ç¨²æ¶æœ¨ï¼ˆã¯ã•ãï¼‰ã‚„è¾²å…·ã®æ‰‹å…¥ã‚Œã‚’ã™ã‚‹å­£ç¯€ã€‚é‡èœã§ã¯ã€å¤§æ ¹ãƒ»ç™½èœãƒ»ã‚«ãƒ–ãªã©å†¬é‡èœãŒç”˜ã¿ã®ãƒ”ãƒ¼ã‚¯ã€‚å¯’æ°—ã«ã‚ãŸã‚‹ã¨ç³–åˆ†ã‚’ãŸã‚è¾¼ã‚€ãŸã‚ã€æ˜”ã‹ã‚‰ã€Œéœœã«ã‚ã¦ã‚‹ã¨æ—¨ããªã‚‹ã€ã¨ã„ã‚ã‚Œã¾ã—ãŸã€‚

ä¿å­˜é£Ÿã¥ãã‚ŠãŒç››ã‚“ã§ã€åˆ‡ã‚Šå¹²ã—å¤§æ ¹ã€ãŸãã‚ã‚“ã€å¹²ã—æŸ¿ã€å‘³å™Œä»•è¾¼ã¿ã€éº¹ã¥ãã‚Šãªã©ã€å†¬ãªã‚‰ã§ã¯ã®å°æ‰€ä»•äº‹ãŒã¤ã¥ãæ™‚æœŸã§ã™ã€‚

ç¾ä»£ã§ã¯å¤§å‹å†·è”µæ–½è¨­ã‚„ç‰©æµãŒæ•´ã£ã¦å­£ç¯€å·®ã¯å°ã•ããªã‚Šã¾ã—ãŸãŒã€ä¼çµ±çš„ãªä¿å­˜æŠ€è¡“ã¯å„åœ°ã§å—ã‘ç¶™ãŒã‚Œã¦ã„ã¾ã™ã€‚"""
            },
            1: {
                'title': 'è¾²é–‘æœŸãƒ»æ˜¥ã¸ã®æº–å‚™',
                'content': """å¯’ã•ãŒå³ã—ãã€è¾²ä½œæ¥­ã¯æœ€å°é™ã€‚ã—ã‹ã—æ˜¥ã«å‘ã‘ã¦ã®å¤§åˆ‡ãªæº–å‚™æœŸé–“ã§ã™ã€‚

è¾²å…·ã®æ‰‹å…¥ã‚Œã¨ä¿®ç†ã€è—ç´°å·¥ã‚„ç¸„ç¶¯ã„ãªã©ã®å®¤å†…ä½œæ¥­ã€å †è‚¥ã¥ãã‚Šã®æº–å‚™ã€æ˜¥ã®ä½œä»˜ã‘è¨ˆç”»ã‚’ç«‹ã¦ã‚‹æ™‚æœŸã€‚

æ˜”ã®è¾²æ‘ã§ã¯ã€ã“ã®æ™‚æœŸã¯ç¸„ã‚’ãªã£ãŸã‚Šã€è¾²å…·ã‚’ä½œã£ãŸã‚Šã™ã‚‹ã€Œå†¬ä»•äº‹ã€ã®æ™‚é–“ã€‚é™ã‹ãªå†¬ã®æ™‚é–“ãŒã€è±Šã‹ãªæ˜¥ã¸ã®æº–å‚™ã‚’æ”¯ãˆã¦ã„ã¾ã—ãŸã€‚"""
            },
            2: {
                'title': 'æ˜¥ã®æº–å‚™é–‹å§‹',
                'content': """ã¾ã å¯’ã•ã¯æ®‹ã‚Šã¾ã™ãŒã€æ˜¥ã¸ã®æº–å‚™ãŒæœ¬æ ¼åŒ–ã€‚

ç¨®ç±¾ã®é¸åˆ¥ã¨æº–å‚™ã€è‚²è‹—åºŠã®æº–å‚™ã€ãƒ“ãƒ‹ãƒ¼ãƒ«ãƒã‚¦ã‚¹ã§ã®è‚²è‹—é–‹å§‹ã€æ¢…ã®å‰ªå®šä½œæ¥­ã€‚

ç«‹æ˜¥ã‚’éãã‚‹ã¨ã€Œæ˜¥ã®è¾²ä½œæ¥­ã€ãŒæ„è­˜ã•ã‚Œå§‹ã‚ã€è¾²å®¶ã®æ°—æŒã¡ã‚‚æ˜¥ã«å‘ã‘ã¦é«˜ã¾ã£ã¦ã„ãã¾ã™ã€‚"""
            },
            3: {
                'title': 'æ˜¥ã®è¾²ç¹æœŸã‚¹ã‚¿ãƒ¼ãƒˆ',
                'content': """æœ¬æ ¼çš„ãªè¾²ä½œæ¥­ã®å§‹ã¾ã‚Šã€‚

ã‚¸ãƒ£ã‚¬ã‚¤ãƒ¢ã®æ¤ãˆä»˜ã‘ã€å¤é‡èœã®ç¨®ã¾ãæº–å‚™ã€æœæ¨¹ã®å‰ªå®šãƒ»æ–½è‚¥ã€ç”°ã‚“ã¼ã®æº–å‚™ï¼ˆç•¦å¡—ã‚Šï¼‰ã€‚

ã€Œæ˜¥å½¼å²¸ã€ã‚’éãã‚‹ã¨ã€å„åœ°ã§ä¸€æ–‰ã«æ˜¥ä½œæ¥­ãŒå§‹ã¾ã‚Šã¾ã™ã€‚è¾²å®¶ã«ã¨ã£ã¦å¿™ã—ãã‚‚å¸Œæœ›ã«æº€ã¡ãŸå­£ç¯€ã§ã™ã€‚"""
            },
            4: {
                'title': 'ç”°æ¤ãˆæº–å‚™æœ¬æ ¼åŒ–',
                'content': """ç”°æ¤ãˆã¸å‘ã‘ã¦æœ€ã‚‚å¿™ã—ã„æ™‚æœŸã€‚

è‹—ä»£ã¥ãã‚Šã€ä»£æ»ãï¼ˆã—ã‚ã‹ãï¼‰ã€ç”°æ¤ãˆã®æº–å‚™ã€å¤é‡èœã®å®šæ¤ã€‚

å…«åå…«å¤œï¼ˆ5æœˆåˆæ—¬ï¼‰ã‚’ç›®å®‰ã«ã€ç¨²ä½œåœ°å¸¯ã§ã¯ç”°æ¤ãˆãŒæœ¬æ ¼åŒ–ã€‚ã€Œå…«åå…«ã€ã®å­—ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã¨ã€Œç±³ã€ã«ãªã‚‹ã“ã¨ã‹ã‚‰ã€ç¸èµ·ã®è‰¯ã„æ—¥ã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚"""
            },
            5: {
                'title': 'ç”°æ¤ãˆã‚·ãƒ¼ã‚ºãƒ³',
                'content': """ç¨²ä½œåœ°å¸¯ã§ã¯ç”°æ¤ãˆã®æœ€ç››æœŸã€‚

ç”°æ¤ãˆä½œæ¥­ã€æ—©ç”Ÿå“ç¨®ã®æ¤ãˆä»˜ã‘ã€å¤é‡èœã®ç®¡ç†ã€æœæ¨¹ã®æ‘˜æœä½œæ¥­ã€‚

ç¾ä»£ã§ã¯æ©Ÿæ¢°åŒ–ãŒé€²ã¿ã¾ã—ãŸãŒã€æ˜”ã¯æ‘ç·å‡ºã®å¤§ä»•äº‹ã€‚ã€Œç”°æ¤ãˆæ­Œã€ã‚’æ­Œã„ãªãŒã‚‰ã€åŠ©ã‘åˆã£ã¦ä½œæ¥­ã‚’ã—ã¦ã„ãŸé¢¨æ™¯ãŒå„åœ°ã«ã‚ã‚Šã¾ã—ãŸã€‚"""
            },
            6: {
                'title': 'æ¢…é›¨æ™‚ã®ç®¡ç†',
                'content': """æ¢…é›¨å…¥ã‚Šã§é›¨ã®æ—¥ãŒå¤šã„å­£ç¯€ã€‚

æ°´ç”°ã®æ°´ç®¡ç†ã€é›‘è‰å¯¾ç­–ã€æ¢…ã®åç©«ã€é‡èœã®ç—…å®³è™«å¯¾ç­–ã€‚

æ¢…ä»•äº‹ãŒç››ã‚“ã§ã€æ¢…å¹²ã—ãƒ»æ¢…é…’ãƒ»æ¢…ã‚·ãƒ­ãƒƒãƒ—ã¥ãã‚ŠãŒå„å®¶åº­ã§è¡Œã‚ã‚Œã¾ã™ã€‚ã€Œæ¢…é›¨ã€ã®åã®é€šã‚Šã€æ¢…ã®å®ŸãŒç†Ÿã™å­£ç¯€ã§ã™ã€‚"""
            },
            7: {
                'title': 'å¤é‡èœæœ€ç››æœŸ',
                'content': """å¤é‡èœãŒæ¬¡ã€…ã¨åç©«æœŸã‚’è¿ãˆã‚‹ã€‚

ãƒˆãƒãƒˆãƒ»ã‚­ãƒ¥ã‚¦ãƒªãƒ»ãƒŠã‚¹ãªã©ã®åç©«ã€ç¨²ã®ä¸­å¹²ã—ä½œæ¥­ã€è‰åˆˆã‚Šä½œæ¥­ã€‚

åœŸç”¨ã®ä¸‘ã®æ—¥å‰å¾Œã¯ã€æ˜”ã‹ã‚‰è¾²ä½œæ¥­ã‚’ä¼‘ã‚€ç¿’æ…£ãŒã‚ã‚Šã€æš‘ã•å¯¾ç­–ã¨ã—ã¦é°»ã‚’é£Ÿã¹ã¦ä½“åŠ›ã‚’ã¤ã‘ã¾ã—ãŸã€‚"""
            },
            8: {
                'title': 'æ®‹æš‘ã®ç®¡ç†',
                'content': """æš‘ã•ãŒç¶šãä¸­ã§ã®ç®¡ç†ä½œæ¥­ã€‚

ç§‹é‡èœã®ç¨®ã¾ãæº–å‚™ã€ç¨²ã®å‡ºç©‚ãƒ»é–‹èŠ±ã€æœæ¨¹ã®åç©«é–‹å§‹ï¼ˆæ¢¨ãƒ»ã¶ã©ã†ï¼‰ã€‚

ãŠç›†å‰å¾Œã¯è¾²ä½œæ¥­ã‚’ä¼‘ã‚€åœ°åŸŸãŒå¤šãã€å…ˆç¥–ã‚’è¿ãˆã‚‹æº–å‚™ã¨ä¼‘æ¯ã®æ™‚é–“ã¨ãªã‚Šã¾ã™ã€‚"""
            },
            9: {
                'title': 'åç©«ã®ç§‹',
                'content': """å®Ÿã‚Šã®å­£ç¯€ã€ç¨²åˆˆã‚ŠãŒæœ¬æ ¼åŒ–ã€‚

ç¨²åˆˆã‚Šä½œæ¥­ã€ã¯ã–ã‹ã‘ï¼ˆå¤©æ—¥å¹²ã—ï¼‰ã€ç§‹é‡èœã®æ¤ãˆä»˜ã‘ã€æœæ¨¹ã®åç©«ã€‚

ã€Œåç©«ã®å–œã³ã€ã‚’æ„Ÿã˜ã‚‹å­£ç¯€ã€‚æ–°ç±³ã®é¦™ã‚ŠãŒç”°èˆã®é¢¨æ™¯ã‚’å½©ã‚Šã¾ã™ã€‚æ˜”ã¯æ‘ã®ç¥­ã‚Šã‚‚å¤šãã€è±Šä½œã‚’ç¥ã†å­£ç¯€ã§ã—ãŸã€‚"""
            },
            10: {
                'title': 'ç§‹ã®åç©«æœ€ç››æœŸ',
                'content': """ç¨²åˆˆã‚Šãƒ»è„±ç©€ãŒçµ‚ç›¤ã‚’è¿ãˆã‚‹ã€‚

è„±ç©€ä½œæ¥­ã€ç§‹é‡èœã®åç©«ï¼ˆã‚µãƒ„ãƒã‚¤ãƒ¢ãƒ»é‡ŒèŠ‹ï¼‰ã€éº¦ã®ç¨®ã¾ãæº–å‚™ã€æœæ¨¹ã®åç©«ç¶šãã€‚

ã€Œæ–°å˜—ç¥­ã€ã¸å‘ã‘ã¦ã€æ–°ç±³ã‚’ç¥ã«æ§ã’ã‚‹æº–å‚™ãŒå§‹ã¾ã‚Šã¾ã™ã€‚åç©«ã¸ã®æ„Ÿè¬ã‚’è¡¨ã™å¤§åˆ‡ãªæ™‚æœŸã§ã™ã€‚"""
            },
            11: {
                'title': 'å†¬æ”¯åº¦é–‹å§‹',
                'content': """è¾²ä½œæ¥­ãŒä¸€æ®µè½ã—ã€å†¬ã¸ã®æº–å‚™ã€‚

å†¬é‡èœã®ç®¡ç†ï¼ˆå¤§æ ¹ãƒ»ç™½èœï¼‰ã€å †è‚¥ã¥ãã‚Šã€è¾²å…·ã®æ‰‹å…¥ã‚Œã€æ¼¬ç‰©ã®ä»•è¾¼ã¿ã€‚

éœœãŒé™ã‚Šå§‹ã‚ã€å†¬é‡èœãŒç”˜ã¿ã‚’å¢—ã™å­£ç¯€ã€‚ãŸãã‚ã‚“æ¼¬ã‘ã€ç™½èœæ¼¬ã‘ãªã©ã€ä¿å­˜é£Ÿã¥ãã‚ŠãŒå„å®¶åº­ã§è¡Œã‚ã‚Œã¾ã™ã€‚"""
            }
        }
        
        return agri_data.get(month, agri_data[12])
    
    @staticmethod
    def get_customs_info(month, day):
        """é¢¨ç¿’ãƒ»ã—ããŸã‚Šï¼ˆæ—¥ä»˜å‹•çš„ï¼‰"""
        # ç‰¹å®šæ—¥ä»˜ã®è¡Œäº‹
        if month == 12 and day == 12:
            return f"""{month}æœˆ{day}æ—¥ã¯æ±Ÿæˆ¸æ™‚ä»£ã«ã€Œå¸«èµ°ã®ç…¤æ‰•ã„ï¼ˆã™ã™ã¯ã‚‰ã„ï¼‰ã€ãŒè¡Œã‚ã‚Œã‚‹æ—¥ã§ã‚‚ã‚ã‚Šã¾ã—ãŸã€‚

ğŸ§¹ æ±Ÿæˆ¸æ™‚ä»£ã®"åäºŒæœˆåäºŒæ—¥ãƒ»ã™ã™æ‰•ã„"

å¤§åå±‹æ•·ã‚„å¯ºç¤¾ã«ä»•ãˆã‚‹äººã€…ãŒä¸€æ–‰ã«å»ºç‰©ã‚’æ¸…ã‚ã‚‹è¡Œäº‹

ç¾ä»£ã®"å¹´æœ«å¤§æƒé™¤"ã®åŸå‹

ç…¤ã‚’æ‰•ã†ã“ã¨ã§ã€Œæ­³ç¥æ§˜ï¼ˆã¨ã—ãŒã¿ã•ã¾ï¼‰ã‚’è¿ãˆã‚‹æº–å‚™ã€ã‚’ã™ã‚‹æ„å‘³ãŒå¼·ã‹ã£ãŸ

åœ°åŸŸã«ã‚ˆã£ã¦ã¯ä»Šã‚‚{day}æ—¥ã‚’ã€Œæƒé™¤ã®æ—¥ã€ã¨ã™ã‚‹å®¶ãŒã‚ã‚Šã¾ã™ã€‚"""
        
        elif month == 1 and day == 7:
            return """1æœˆ7æ—¥ã¯ã€Œä¸ƒè‰ã®ç¯€å¥ã€ã€‚

æ˜¥ã®ä¸ƒè‰ï¼ˆèŠ¹ãƒ»è–ºãƒ»å¾¡å½¢ãƒ»ç¹ç¸·ãƒ»ä»ã®åº§ãƒ»è˜ãƒ»è˜¿è””ï¼‰ã‚’ç²¥ã«ã—ã¦é£Ÿã¹ã‚‹ç¿’æ…£ãŒã‚ã‚Šã¾ã™ã€‚æ­£æœˆã®ã”é¦³èµ°ã§ç–²ã‚ŒãŸèƒƒè…¸ã‚’ä¼‘ã‚ã€ä¸€å¹´ã®ç„¡ç—…æ¯ç½ã‚’é¡˜ã†æ„å‘³ãŒè¾¼ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

ã€Œä¸ƒè‰ãªãšãªã€å”åœŸã®é³¥ãŒæ—¥æœ¬ã®åœŸåœ°ã«æ¸¡ã‚‰ã¬å…ˆã«â€¦ã€ã¨å”±ãˆãªãŒã‚‰åŒ…ä¸ã§å©ãé¢¨ç¿’ã‚‚æ®‹ã£ã¦ã„ã¾ã™ã€‚"""
        
        elif month == 2 and day == 3:
            return """2æœˆ3æ—¥é ƒã¯ã€Œç¯€åˆ†ã€ã€‚

ç«‹æ˜¥ã®å‰æ—¥ã«ã‚ãŸã‚Šã€å­£ç¯€ã®å¤‰ã‚ã‚Šç›®ã«é‚ªæ°—ã‚’æ‰•ã†è¡Œäº‹ã€‚è±†ã¾ãã‚’ã—ã¦é¬¼ã‚’è¿½ã„æ‰•ã„ã€å¹´é½¢ã®æ•°ã ã‘è±†ã‚’é£Ÿã¹ã¦ä¸€å¹´ã®å¥åº·ã‚’é¡˜ã„ã¾ã™ã€‚

æµæ–¹å·»ã‚’é£Ÿã¹ã‚‹ç¿’æ…£ã¯å¤§é˜ªãŒç™ºç¥¥ã§ã€è¿‘å¹´å…¨å›½ã«åºƒã¾ã‚Šã¾ã—ãŸã€‚"""
        
        # æœˆã”ã¨ã®ä¸€èˆ¬çš„ãªé¢¨ç¿’
        customs_by_month = {
            12: """12æœˆã¯ä¸€å¹´ã®ç· ã‚ããã‚Šã®æœˆã€‚

å†¬å›²ã„ï¼ˆé›ªå›½ã§å®¶ã‚„åº­æœ¨ã‚’å®ˆã‚‹ä½œæ¥­ï¼‰ã€ã™ã™æ‰•ã„ï¼ˆå¤§æƒé™¤ã®èµ·æºï¼‰ã€æ­£æœˆé£¾ã‚Šã®æº–å‚™ã€å†¬è‡³ã®æŸšå­æ¹¯ï¼ˆ12æœˆ21æ—¥é ƒï¼‰ã€å¹´è¶Šã—ãã°ï¼ˆå¤§æ™¦æ—¥ï¼‰

ãªã©ã€æ­³ç¥æ§˜ã‚’è¿ãˆã‚‹æº–å‚™ã¨ä¸€å¹´ã®ç©¢ã‚Œã‚’æ‰•ã†è¡Œäº‹ãŒç¶šãã¾ã™ã€‚""",
            
            1: """1æœˆã¯æ–°å¹´ã‚’è¿ãˆã‚‹æœ€ã‚‚é‡è¦ãªæœˆã€‚

åˆè©£ã€ä¸ƒè‰ç²¥ï¼ˆ1æœˆ7æ—¥ï¼‰ã€é¡é–‹ãï¼ˆ1æœˆ11æ—¥ï¼‰ã€å°æ­£æœˆï¼ˆ1æœˆ15æ—¥ï¼‰ã€å¯’ä¸­è¦‹èˆã„

ãªã©ã€ä¸€å¹´ã®å§‹ã¾ã‚Šã«ãµã•ã‚ã—ã„ä¼çµ±è¡Œäº‹ãŒç›®ç™½æŠ¼ã—ã§ã™ã€‚""",
            
            2: """2æœˆã¯ç¯€åˆ†ã§è±†ã¾ãã‚’è¡Œã„ã€ç«‹æ˜¥ã‚’è¿ãˆã‚‹æœˆã€‚

ç¯€åˆ†ãƒ»è±†ã¾ãï¼ˆ2æœˆ3æ—¥é ƒï¼‰ã€åˆåˆï¼ˆã¯ã¤ã†ã¾ï¼‰ã€å»ºå›½è¨˜å¿µã®æ—¥ï¼ˆ2æœˆ11æ—¥ï¼‰ã€é‡ä¾›é¤Šï¼ˆ2æœˆ8æ—¥ï¼‰

å¯’ã•ã®ä¸­ã«ã‚‚æ˜¥ã®æ°—é…ã‚’æ„Ÿã˜ã‚‹å­£ç¯€ã§ã™ã€‚""",
            
            3: """3æœˆã¯ã²ãªç¥­ã‚Šã§å¥³ã®å­ã®æˆé•·ã‚’ç¥ã„ã€æ˜¥åˆ†ã®æ—¥ã«ã¯å½¼å²¸ã®å¢“å‚ã‚Šã‚’è¡Œã„ã¾ã™ã€‚

ã²ãªç¥­ã‚Šï¼ˆ3æœˆ3æ—¥ï¼‰ã€å•“èŸ„ã€æ˜¥åˆ†ã®æ—¥ãƒ»å½¼å²¸ã€å’æ¥­å¼ã€ãƒ›ãƒ¯ã‚¤ãƒˆãƒ‡ãƒ¼

æ˜¥ã®è¨ªã‚Œã‚’ç¥ã†è¡Œäº‹ãŒç¶šãã¾ã™ã€‚"""
        }
        
        return customs_by_month.get(month, f"{month}æœˆã®ä¼çµ±çš„ãªé¢¨ç¿’ã«ã¤ã„ã¦")
    
    @staticmethod
    def get_events_info(month, day):
        """è¨˜å¿µæ—¥ãƒ»å‡ºæ¥äº‹ï¼ˆæ—¥ä»˜ç‰¹å®šï¼‰"""
        events = {
            (12, 12): """ãƒ»ãƒãƒƒãƒ†ãƒªãƒ¼ã®æ—¥ï¼ˆæ—¥æœ¬è“„é›»æ± å·¥æ¥­ä¼šï¼‰
12ï¼ˆã˜ã‚…ã†ï¼‰12ï¼ˆã˜ã‚…ã†ï¼‰ã§ã€Œé‡é›»ã€ã€‚ç¾åœ¨ã¯ã‚ˆã‚Šåºƒã„æ„å‘³ã§é›»æ± ãƒ»è“„é›»æŠ€è¡“ã«é–¢ã™ã‚‹å•“ç™ºã®æ—¥ã€‚

ãƒ»æ¼¢å­—ã®æ—¥ï¼ˆæ—¥æœ¬æ¼¢å­—èƒ½åŠ›æ¤œå®šå”ä¼šï¼‰
"ã„ã„å­—ä¸€å­—ï¼ˆ12/12ï¼‰"ã®èªå‘‚åˆã‚ã›ã€‚
ãã—ã¦äº¬éƒ½ãƒ»æ¸…æ°´å¯ºã§**ã€Œä»Šå¹´ã®æ¼¢å­—ã€**ãŒç™ºè¡¨ã•ã‚Œã‚‹ã®ã¯å¿…ãšã“ã®æ—¥ã§ã™ã€‚æ­³æœ«ã®é¢¨ç‰©è©©ã§ã™ã­ã€‚""",
            
            (1, 1): """ãƒ»å…ƒæ—¥ï¼ˆå›½æ°‘ã®ç¥æ—¥ï¼‰
ä¸€å¹´ã®å§‹ã¾ã‚Šã‚’ç¥ã†æœ€ã‚‚é‡è¦ãªæ—¥ã€‚åˆæ—¥ã®å‡ºã‚’æ‹ã¿ã€ãŠã›ã¡æ–™ç†ã‚’ã„ãŸã ãã€åˆè©£ã«å‡ºã‹ã‘ã‚‹ç¿’æ…£ãŒã‚ã‚Šã¾ã™ã€‚

ãƒ»å°‘å¹´æ³•æ–½è¡Œã®æ—¥
1949å¹´ã®ã“ã®æ—¥ã€å°‘å¹´æ³•ãŒæ–½è¡Œã•ã‚Œã¾ã—ãŸã€‚""",
            
            (1, 7): """ãƒ»ä¸ƒè‰ã®ç¯€å¥
æ˜¥ã®ä¸ƒè‰ç²¥ã‚’é£Ÿã¹ã¦ç„¡ç—…æ¯ç½ã‚’é¡˜ã†æ—¥ã€‚

ãƒ»çˆªåˆ‡ã‚Šã®æ—¥
æ–°å¹´ã«ãªã£ã¦åˆã‚ã¦çˆªã‚’åˆ‡ã‚‹æ—¥ã¨ã•ã‚Œã€ä¸ƒè‰ã‚’æµ¸ã—ãŸæ°´ã«çˆªã‚’ã¤ã‘ã¦åˆ‡ã‚‹ã¨é¢¨é‚ªã‚’ã²ã‹ãªã„ã¨ã„ã†è¨€ã„ä¼ãˆãŒã‚ã‚Šã¾ã™ã€‚""",
            
            (2, 3): """ãƒ»ç¯€åˆ†
ç«‹æ˜¥ã®å‰æ—¥ã€‚è±†ã¾ãã§é‚ªæ°—ã‚’æ‰•ã„ã€æµæ–¹å·»ã‚’é£Ÿã¹ã‚‹ç¿’æ…£ãŒåºƒã¾ã£ã¦ã„ã¾ã™ã€‚

ãƒ»å¤§è±†ã®æ—¥
ç¯€åˆ†ã«å› ã‚“ã§åˆ¶å®šã•ã‚Œã¾ã—ãŸã€‚""",
            
            (3, 3): """ãƒ»ã²ãªç¥­ã‚Šï¼ˆæ¡ƒã®ç¯€å¥ï¼‰
å¥³ã®å­ã®å¥ã‚„ã‹ãªæˆé•·ã‚’é¡˜ã†æ—¥ã€‚ã²ãªäººå½¢ã‚’é£¾ã‚Šã€è±é¤…ã‚„ã²ãªã‚ã‚‰ã‚Œã‚’æ¥½ã—ã¿ã¾ã™ã€‚

ãƒ»è€³ã®æ—¥
ã€Œã¿ï¼ˆ3ï¼‰ã¿ï¼ˆ3ï¼‰ã€ã®èªå‘‚åˆã‚ã›ã€‚"""
        }
        
        key = (month, day)
        if key in events:
            return events[key]
        else:
            return f"""{month}æœˆ{day}æ—¥ã¯ã€åœ°åŸŸã«ã‚ˆã£ã¦æ§˜ã€…ãªè¡Œäº‹ã‚„é¢¨ç¿’ãŒã‚ã‚‹æ—¥ã§ã™ã€‚

å­£ç¯€ã®ç¯€ç›®ã¨ã—ã¦ã€ãã‚Œãã‚Œã®åœŸåœ°ã§å¤§åˆ‡ã«ã•ã‚Œã¦ããŸæ–‡åŒ–ãŒã‚ã‚Šã¾ã™ã€‚"""


class GeminiEnhancer:
    """Gemini APIã§æ–‡ç« å……å®Ÿ"""
    
    def __init__(self, api_key):
        self.api_key = api_key
        self.base_url = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent"
        self.request_count = 0
        self.max_requests = 6  # ä¸»è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã¿å¼·åŒ–
    
    def enhance_text(self, section_name, base_text, context=""):
        """æ–‡ç« ã‚’å……å®Ÿã•ã›ã‚‹"""
        if not self.api_key or self.request_count >= self.max_requests:
            return base_text
        
        prompt = f"""ä»¥ä¸‹ã®æš¦æƒ…å ±ã€Œ{section_name}ã€ã‚’ã€æ¸©ã‹ãè¦ªã—ã¿ã‚„ã™ã„æ–‡ç« ã«æ‹¡å……ã—ã¦ãã ã•ã„ã€‚

ã€å…ƒã®æ–‡ç« ã€‘
{base_text}

ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã€‘
{context}

ã€è¦ä»¶ã€‘
- 400-600æ–‡å­—ç¨‹åº¦ã«æ‹¡å……
- å…·ä½“çš„ãªã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæµ®ã‹ã¶è¡¨ç¾
- èª­è€…ã«èªã‚Šã‹ã‘ã‚‹æ¸©ã‹ã„èªã‚Šå£
- å­£ç¯€æ„Ÿã‚„æ—¥æœ¬ã®ä¼çµ±ã‚’å¤§åˆ‡ã«
- è¦‹æœ¬ã®ã‚ˆã†ãªå……å®Ÿã—ãŸå†…å®¹

å……å®Ÿã•ã›ãŸæ–‡ç« ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼ˆå‰ç½®ãã‚„èª¬æ˜ã¯ä¸è¦ï¼‰ã€‚"""
        
        try:
            headers = {'Content-Type': 'application/json'}
            data = {
                "contents": [{
                    "parts": [{"text": prompt}]
                }],
                "generationConfig": {
                    "temperature": 0.8,
                    "maxOutputTokens": 1000
                }
            }
            
            response = requests.post(
                f"{self.base_url}?key={self.api_key}",
                headers=headers,
                json=data,
                timeout=30
            )
            
            if response.status_code == 200:
                result = response.json()
                enhanced = result['candidates'][0]['content']['parts'][0]['text'].strip()
                self.request_count += 1
                time.sleep(2)
                return enhanced
            else:
                return base_text
                
        except Exception as e:
            print(f"Gemini API ã‚¨ãƒ©ãƒ¼: {str(e)}")
            return base_text


class ComprehensiveCalendarGenerator:
    """åŒ…æ‹¬çš„ãªæš¦æƒ…å ±ç”Ÿæˆï¼ˆæ—¥ä»˜å¯¾å¿œç‰ˆï¼‰"""
    
    def __init__(self, target_date=None, gemini_api_key=None):
        self.jst = ZoneInfo("Asia/Tokyo")
        self.date = target_date or datetime.now(self.jst)
        self.gemini = GeminiEnhancer(gemini_api_key) if gemini_api_key else None
        self.month = self.date.month
        self.day = self.date.day
        self.data_provider = SeasonalDataProvider()
    
    def generate_full_html(self):
        """å®Œå…¨ç‰ˆHTMLç”Ÿæˆ"""
        lunar = LunarCalendar.calculate_lunar_date(self.date)
        sekki = AstronomicalCalculator.get_current_sekki(self.date)
        kou = AstronomicalCalculator.get_current_kou(self.date)
        
        weekdays = ["æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ", "æ—¥"]
        weekday = weekdays[self.date.weekday()]
        
        lunar_month_name = LunarCalendar.get_lunar_month_name(lunar['month'])
        seasonal_words = self.data_provider.get_seasonal_words(self.month, self.day)
        
        # å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆï¼ˆã™ã¹ã¦æ—¥ä»˜å¯¾å¿œï¼‰
        intro_section = self._generate_intro_section(lunar, lunar_month_name, sekki)
        sekki_section = self._generate_sekki_section(sekki, kou)
        agri_section = self._generate_agriculture_section()
        customs_section = self._generate_customs_section()
        events_section = self._generate_events_section()
        mythology_section = self._generate_mythology_section(sekki, kou)
        trivia_section = self._generate_trivia_section(lunar_month_name)
        nature_section = self._generate_nature_section(sekki, kou)
        food_section = self._generate_food_section()
        flower_section = self._generate_flower_section()
        astro_section = self._generate_astronomy_section(lunar)
        craft_section = self._generate_craft_section()
        festival_section = self._generate_festival_section()
        arts_section = self._generate_arts_section()
        
        html = f"""
<div style="font-family: 'ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ Pro', 'Hiragino Kaku Gothic Pro', 'ãƒ¡ã‚¤ãƒªã‚ª', Meiryo, sans-serif; max-width: 900px; margin: 0 auto; line-height: 1.9; color: #2d3748;">

<h2 style="color: #2c5282; border-bottom: 4px solid #4299e1; padding-bottom: 12px; margin-bottom: 25px; font-size: 28px;">ğŸ“… ä»Šæ—¥ã®æš¦æƒ…å ±</h2>

<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.15);">
<p style="margin: 0; font-size: 22px; font-weight: bold;">è¥¿æš¦ï¼š{self.date.year}å¹´{self.date.month}æœˆ{self.date.day}æ—¥ï¼ˆ{weekday}æ›œæ—¥ï¼‰</p>
<p style="margin: 12px 0 0 0; font-size: 19px;">æ—§æš¦ï¼š{lunar_month_name}ï¼ˆ{lunar['day']}æ—¥ï¼‰</p>
<p style="margin: 10px 0 0 0; font-size: 18px;">æœˆé½¢ï¼š{lunar['age']}ï¼ˆ{lunar['phase']}ï¼‰</p>
<p style="margin: 10px 0 0 0; font-size: 18px;">å¹²æ”¯ï¼š{lunar['eto']}</p>
<p style="margin: 10px 0 0 0; font-size: 18px;">å…­æ›œï¼š{lunar['rokuyou']}</p>
<p style="margin: 10px 0 0 0; font-size: 17px;">å­£ç¯€ã®è¨€è‘‰ï¼š{seasonal_words}</p>
</div>

{intro_section}

<hr style="border: none; border-top: 3px solid #e2e8f0; margin: 40px 0;">

{sekki_section}

<hr style="border: none; border-top: 3px solid #e2e8f0; margin: 40px 0;">

{agri_section}

<hr style="border: none; border-top: 3px solid #e2e8f0; margin: 40px 0;">

{customs_section}

<hr style="border: none; border-top: 3px solid #e2e8f0; margin: 40px 0;">

{events_section}

<hr style="border: none; border-top: 3px solid #e2e8f0; margin: 40px 0;">

{mythology_section}

<hr style="border: none; border-top: 3px solid #e2e8f0; margin: 40px 0;">

{trivia_section}

<hr style="border: none; border-top: 3px solid #e2e8f0; margin: 40px 0;">

{nature_section}

<hr style="border: none; border-top: 3px solid #e2e8f0; margin: 40px 0;">

{food_section}

<hr style="border: none; border-top: 3px solid #e2e8f0; margin: 40px 0;">

{flower_section}

<hr style="border: none; border-top: 3px solid #e2e8f0; margin: 40px 0;">

{astro_section}

<hr style="border: none; border-top: 3px solid #e2e8f0; margin: 40px 0;">

{craft_section}

<hr style="border: none; border-top: 3px solid #e2e8f0; margin: 40px 0;">

{festival_section}

<hr style="border: none; border-top: 3px solid #e2e8f0; margin: 40px 0;">

{arts_section}

<hr style="border: none; border-top: 3px solid #e2e8f0; margin: 40px 0;">

<div style="background: linear-gradient(135deg, #f0fdf4, #dcfce7); padding: 30px; border-radius: 15px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.08);">
<p style="margin: 0; font-size: 18px; color: #14532d; font-weight: 500; line-height: 2;">
å­£ç¯€ã®ç§»ã‚ã„ã‚’æ„Ÿã˜ãªãŒã‚‰ã€å¿ƒç©ã‚„ã‹ãªä¸€æ—¥ã‚’ãŠéã”ã—ãã ã•ã„
</p>
</div>

</div>
"""
        
        return {
            'title': f'{self.date.year}å¹´{self.date.month}æœˆ{self.date.day}æ—¥({weekday})ã®æš¦ - {sekki[0]}ãƒ»{lunar_month_name}',
            'content': html,
            'labels': ['æš¦', 'äºŒåå››ç¯€æ°—', 'ä¸ƒåäºŒå€™', 'æ—§æš¦', 'å­£ç¯€', 'ä¼çµ±', 'è¡Œäº‹', 'è‡ªç„¶', 'æœˆé½¢', 'å¹²æ”¯']
        }
    
    def _generate_intro_section(self, lunar, lunar_month_name, sekki):
        """å°å…¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæ—¥ä»˜å¯¾å¿œï¼‰"""
        base = f"""æ—§æš¦ã§ã¯ã¾ã {lunar_month_name}ã€‚æœˆé½¢{lunar['age']}ã®{lunar['phase']}ãŒ{lunar['appearance']}ã€‚

ç©ºæ°—ãŒæ¾„ã¿åˆ‡ã‚‹å­£ç¯€ã¯ã€æ˜Ÿã‚„æœˆãŒæœ€ã‚‚ãã£ãã‚Šè¦‹ãˆã‚‹æ™‚æœŸã§ã‚‚ã‚ã‚Šã¾ã™ã€‚

"{lunar_month_name}"ã¨ã„ã†åã«ã¯ã€å¤æ¥ã‹ã‚‰ã®å­£ç¯€æ„ŸãŒè¾¼ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚äºŒåå››ç¯€æ°—ã§ã¯{sekki[0]}ã‚’è¿ãˆã€è‡ªç„¶ã®ç§»ã‚ã„ã‚’è‚Œã§æ„Ÿã˜ã‚‰ã‚Œã‚‹é ƒã§ã™ã€‚"""
        
        if self.gemini:
            enhanced = self.gemini.enhance_text("å­£ç¯€ã®å°å…¥", base, f"{self.month}æœˆ{self.day}æ—¥")
        else:
            enhanced = base
        
        return f"""<div style="background: #f7fafc; padding: 28px; border-radius: 12px; border-left: 5px solid #4299e1; margin-bottom: 35px;">
<p style="margin: 0; line-height: 2; font-size: 16px;">{enhanced}</p>
</div>"""
    
    def _generate_sekki_section(self, sekki, kou):
        """äºŒåå››ç¯€æ°—ãƒ»ä¸ƒåäºŒå€™ã‚»ã‚¯ã‚·ãƒ§ãƒ³"""
        base = f"""äºŒåå››ç¯€æ°—ã§ã¯{sekki[0]}ï¼ˆ{sekki[1]}ï¼‰ã€‚{sekki[2]}

ä¸ƒåäºŒå€™ã§ã¯{kou[0]}ï¼ˆ{kou[1]}ï¼‰ã€‚{kou[2]}

ã“ã®æ™‚æœŸã®è‡ªç„¶ã®å¤‰åŒ–ã¯ã€æ—¥æœ¬äººãŒé•·å¹´å¤§åˆ‡ã«ã—ã¦ããŸå­£ç¯€ã®æš¦ãã®ã‚‚ã®ã§ã™ã€‚"""
        
        if self.gemini:
            enhanced = self.gemini.enhance_text("äºŒåå››ç¯€æ°—ãƒ»ä¸ƒåäºŒå€™", base, f"{sekki[0]}ã€{kou[0]}")
        else:
            enhanced = base
        
        return f"""<h3 style="color: #2d3748; font-size: 26px; margin-bottom: 25px; border-left: 6px solid #fc8181; padding-left: 15px;">â˜€ï¸ å­£ç¯€ã®ç§»ã‚ã„ï¼ˆä¸ƒåäºŒå€™ãƒ»äºŒåå››ç¯€æ°—ï¼‰</h3>
<div style="background: linear-gradient(to right, #fff5f5, transparent); border-left: 6px solid #fc8181; padding: 28px; margin-bottom: 25px; border-radius: 8px;">
<p style="margin: 0; color: #2d3748; line-height: 2; font-size: 16px; white-space: pre-line;">{enhanced}</p>
</div>"""
    
    def _generate_agriculture_section(self):
        """è¾²äº‹æ­´ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæœˆã”ã¨ã«å¤‰åŒ–ï¼‰"""
        agri_info = self.data_provider.get_agriculture_info(self.month, self.day)
        
        if self.gemini:
            enhanced = self.gemini.enhance_text("è¾²äº‹æ­´", agri_info['content'], f"{self.month}æœˆã®è¾²ä½œæ¥­")
        else:
            enhanced = agri_info['content']
        
        return f"""<h3 style="color: #2d3748; font-size: 26px; margin-bottom: 25px; border-left: 6px solid #68d391; padding-left: 15px;">ğŸšœ è¾²äº‹æ­´ï¼ˆè¾²æ¥­æš¦ï¼‰</h3>
<div style="background: linear-gradient(135deg, #fef5e7, #fef3c7); padding: 28px; border-radius: 12px; margin-bottom: 30px;">
<h4 style="color: #744210; margin: 0 0 15px 0; font-size: 20px;">{agri_info['title']}</h4>
<p style="margin: 0; color: #744210; line-height: 2; font-size: 16px; white-space: pre-line;">{enhanced}</p>
</div>"""
    
    def _generate_customs_section(self):
        """é¢¨ç¿’ãƒ»ã—ããŸã‚Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæ—¥ä»˜å¯¾å¿œï¼‰"""
        customs_text = self.data_provider.get_customs_info(self.month, self.day)
        
        return f"""<h3 style="color: #2d3748; font-size: 26px; margin-bottom: 25px; border-left: 6px solid #9f7aea; padding-left: 15px;">ğŸ¡ æ—¥æœ¬ã®é¢¨ç¿’ãƒ»ã—ããŸã‚Š</h3>
<div style="background: #faf5ff; padding: 28px; border-radius: 12px; border-left: 6px solid #9f7aea; margin-bottom: 30px;">
<p style="margin: 0; color: #2d3748; line-height: 2; font-size: 16px; white-space: pre-line;">{customs_text}</p>
</div>"""
    
    def _generate_events_section(self):
        """è¨˜å¿µæ—¥ãƒ»å‡ºæ¥äº‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæ—¥ä»˜å¯¾å¿œï¼‰"""
        events_text = self.data_provider.get_events_info(self.month, self.day)
        
        return f"""<h3 style="color: #2d3748; font-size: 26px; margin-bottom: 25px; border-left: 6px solid #f6ad55; padding-left: 15px;">ğŸŒ æ—¥æœ¬ã®è¨˜å¿µæ—¥ãƒ»å‡ºæ¥äº‹</h3>
<div style="background: linear-gradient(135deg, #fffaf0, #fef3c7); padding: 28px; border-radius: 12px; margin-bottom: 30px;">
<p style="margin: 0; color: #744210; line-height: 2; font-size: 16px; white-space: pre-line;">{events_text}</p>
</div>"""
    
    def _generate_mythology_section(self, sekki, kou):
        """ç¥è©±ãƒ»ä¼èª¬ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå­£ç¯€å¯¾å¿œï¼‰"""
        mythology_data = {
            12: f"""å†¬ã®å…¥å£ã«èªã‚‰ã‚Œã‚‹ã“ã¨ã®å¤šã„ã®ã¯ã€å¤§å›½ä¸»å‘½ï¼ˆãŠãŠãã«ã¬ã—ã®ã¿ã“ã¨ï¼‰ã¨å› å¹¡ã®ç™½å…ã®ç¥è©±ã€‚

{sekki[0]}ã®é ƒã€ç™½å…ãŒæ¯›ã‚’è†¨ã‚‰ã¾ã›ä¸¸ããªã‚‹å§¿ã¨é‡ã­ã‚‰ã‚Œã€ã€Œå†¬ã®å®ˆã‚Šç¥ã€ã¨ã—ã¦å„åœ°ã®å› å¹¡ç¥ç¤¾ã§å…ã®çµµé¦¬ãŒå¥‰ç´ã•ã‚Œã‚‹ã“ã¨ã‚‚ã€‚

ã¾ãŸã€å†¬ã¯"æ­»ã¨å†ç”Ÿ"ã®è±¡å¾´ã¨ã—ã¦èªã‚‰ã‚Œã€ã‚¤ã‚¶ãƒŠãƒŸãŒé»„æ³‰ã¸å»ã‚Šã€ã‚¤ã‚¶ãƒŠã‚®ãŒç¦Šã‚’ã—ã¦å†ç”Ÿã™ã‚‹ç¥è©±ã‚‚ã€å†¬è‡³å‰ã®ç¯€ç›®ã«èªã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚""",
            
            1: """æ–°å¹´ã«èªã‚‰ã‚Œã‚‹ã®ã¯ã€å¹´ç¥æ§˜ï¼ˆã¨ã—ãŒã¿ã•ã¾ï¼‰ã®ä¼èª¬ã€‚

å¤©ç…§å¤§ç¥ã®ç³»è­œã«ã¤ãªãŒã‚‹æ­³ç¥ã¯ã€æ–°ã—ã„å¹´ã®å¹¸ç¦ã¨è±Šä½œã‚’ã‚‚ãŸã‚‰ã™ç¥ã¨ã—ã¦ã€å„å®¶åº­ã«è¨ªã‚Œã‚‹ã¨ä¿¡ã˜ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚é–€æ¾ã‚„é¡é¤…ã¯ã€ã“ã®æ­³ç¥æ§˜ã‚’è¿ãˆã‚‹ãŸã‚ã®ä¾ã‚Šä»£ã§ã™ã€‚

ã¾ãŸã€ä¸ƒç¦ç¥ä¿¡ä»°ã‚‚æ­£æœˆã«ç››ã‚“ã§ã€å®èˆ¹ã«ä¹—ã£ãŸä¸ƒç¦ç¥ã®çµµã‚’æ•ã®ä¸‹ã«ç½®ãã¨è‰¯ã„åˆå¤¢ãŒè¦‹ã‚‰ã‚Œã‚‹ã¨ã„ã†è¨€ã„ä¼ãˆãŒã‚ã‚Šã¾ã™ã€‚""",
            
            2: """ç¯€åˆ†ã®é¬¼é€€æ²»ã¯ã€å¤äº‹è¨˜ã®é»„æ³‰ã®å›½ã®ç‰©èªã¨é–¢é€£ãŒã‚ã‚‹ã¨ã•ã‚Œã¾ã™ã€‚

ã‚¤ã‚¶ãƒŠã‚®ãŒé»„æ³‰ã‹ã‚‰é€ƒã’å¸°ã‚‹éš›ã€è¿½ã£ã¦ãã‚‹é¬¼ãŸã¡ã«æ¡ƒã®å®Ÿã‚’æŠ•ã’ã¦é€€æ•£ã•ã›ãŸç¥è©±ãŒã€è±†ã¾ãã®èµ·æºã¨ã‚‚ã€‚

ã¾ãŸã€ç«‹æ˜¥ã¯æ–°ã—ã„å¹´ã®å§‹ã¾ã‚Šã¨ã•ã‚Œã€æ—§æš¦ã§ã®ã€Œå¹´è¶Šã—ã€ã®æ„å‘³ã‚’æŒã£ã¦ã„ã¾ã—ãŸã€‚""",
            
            3: """æ˜¥åˆ†ã®é ƒã¯ã€å¤©ç…§å¤§ç¥ãŒå²©æˆ¸ã‹ã‚‰å‡ºç¾ã—ãŸç¥è©±ã¨é‡ã­ã‚‰ã‚Œã‚‹ã“ã¨ã‚‚ã€‚

æ˜¼å¤œãŒç­‰ã—ããªã‚‹æ—¥ã¯ã€é™°ã¨é™½ã®ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚ŒãŸæ—¥ã¨ã•ã‚Œã€å½¼å²¸ã®ä¸­æ—¥ã¨ã—ã¦å…ˆç¥–ä¾›é¤ŠãŒè¡Œã‚ã‚Œã¾ã™ã€‚

ã¾ãŸã€æ¡œã®é–‹èŠ±ã¯ã€æœ¨èŠ±å’²è€¶å§«ï¼ˆã“ã®ã¯ãªã•ãã‚„ã²ã‚ï¼‰ã®ç‰©èªã¨çµã³ã¤ãã€èŠ±ã®ç¾ã—ã•ã¨å„šã•ãŒèªã‚Šç¶™ãŒã‚Œã¦ã„ã¾ã™ã€‚"""
        }
        
        base = mythology_data.get(self.month, f"{sekki[0]}ã®å­£ç¯€ã«ä¼ã‚ã‚‹ç¥è©±ã‚„ä¼èª¬ã¯ã€æ—¥æœ¬å„åœ°ã§èªã‚Šç¶™ãŒã‚Œã¦ã„ã¾ã™ã€‚")
        
        return f"""<h3 style="color: #2d3748; font-size: 26px; margin-bottom: 25px; border-left: 6px solid #ed64a6; padding-left: 15px;">ğŸ“š æ—¥æœ¬ã®ç¥è©±ãƒ»ä¼èª¬</h3>
<div style="background: linear-gradient(135deg, #fef5f8, #fce7f3); padding: 28px; border-radius: 12px; margin-bottom: 30px;">
<p style="margin: 0; color: #831843; line-height: 2; font-size: 16px; white-space: pre-line;">{base}</p>
</div>"""
    
    def _generate_trivia_section(self, lunar_month_name):
        """æ–‡åŒ–é›‘å­¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæœˆå¯¾å¿œï¼‰"""
        trivia_data = {
            "å¸«èµ°": f"""â— ãªãœ{self.month}æœˆ{self.day}æ—¥ã«ã€Œã™ã™æ‰•ã„ã€ï¼Ÿ

æ±Ÿæˆ¸åŸã§æ±ºã‚ã‚‰ã‚ŒãŸå¹´ä¸­è¡Œäº‹ãŒè«¸å¤§åå®¶ã‚„åº¶æ°‘ã«åºƒãŒã£ãŸãŸã‚ã€‚ä¸‰ä»£å°†è»å®¶å…‰ã®å‘½ã§è«¸å¤§åãŒ{self.day}æ—¥ã«ç·å‡ºã§æƒé™¤ã‚’ã—ãŸè¨˜éŒ²ãŒæ®‹ã£ã¦ã„ã¾ã™ã€‚

â— å¸«èµ°ã¯"ã—ã¯ã™"ï¼Ÿ"ã—ã‚ã™"ï¼Ÿ

æœ¬æ¥ã®ç™ºéŸ³ã¯ã€Œã—ã¯ã™ï¼ˆshi-ha-suï¼‰ã€ã€‚ç¾ä»£ã®"ã—ã‚ã™"ã¯é€£éŸ³åŒ–ã—ãŸå½¢ã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚èªæºã¯ã€Œå¸«ï¼ˆåƒ§ä¾¶ï¼‰ãŒèµ°ã‚‹ã€ã€Œå¹´ãŒæœã¦ã‚‹ï¼ˆã—ã¯ã™ï¼‰ã€ãªã©è«¸èª¬ã‚ã‚Šã¾ã™ã€‚""",
            
            "ç¦æœˆ": """â— ãªãœã€Œç¦æœˆã€ï¼Ÿ

æ­£æœˆã«è¦ªæ—ãŒé›†ã¾ã‚Šã€Œç¦ã¿åˆã†ã€ã“ã¨ã‹ã‚‰ã€‚ã¾ãŸã€Œå…ƒæœˆï¼ˆã‚‚ã¨ã¤ãï¼‰ã€ãŒè»¢ã˜ãŸã¨ã„ã†èª¬ã‚‚ã‚ã‚Šã¾ã™ã€‚

â— æ—§æ­£æœˆã¨ã®é•ã„ã¯ï¼Ÿ

æ˜æ²»5å¹´ã¾ã§æ—¥æœ¬ã¯æ—§æš¦ã‚’ä½¿ç”¨ã€‚ç¾åœ¨ã®1æœˆ1æ—¥ã¯æ–°æš¦ã§ã®æ­£æœˆã§ã™ãŒã€ä¸­å›½ã‚„éŸ“å›½ã§ã¯ä»Šã‚‚æ—§æš¦ã®æ­£æœˆï¼ˆæ˜¥ç¯€ï¼‰ã‚’ç››å¤§ã«ç¥ã„ã¾ã™ã€‚""",
            
            "å¦‚æœˆ": """â— ã€Œå¦‚æœˆã€ã®ç”±æ¥ã¯ï¼Ÿ

ã€Œè¡£æ›´ç€ï¼ˆãã¬ã•ã‚‰ãï¼‰ã€ãŒè»¢ã˜ãŸã‚‚ã®ã€‚å¯’ã•ã§æ›´ã«è¡£ã‚’é‡ã­ç€ã™ã‚‹æœˆã¨ã„ã†æ„å‘³ã§ã™ã€‚

â— ç¯€åˆ†ã®ã€Œé¬¼ã¯å¤–ã€ç¦ã¯å†…ã€

å®Ÿã¯åœ°åŸŸã‚„ç¥ç¤¾ã«ã‚ˆã£ã¦é•ã„ãŒã‚ã‚Šã¾ã™ã€‚é¬¼ã‚’ç¥€ã‚‹ç¥ç¤¾ã§ã¯ã€Œé¬¼ã‚‚å†…ã€ã¨å”±ãˆã‚‹ã“ã¨ã‚‚ã€‚""",
            
            "å¼¥ç”Ÿ": """â— ã€Œå¼¥ç”Ÿã€ã®æ„å‘³ã¯ï¼Ÿ

ã€Œå¼¥ï¼ˆã„ã‚„ï¼‰ã€ã¯ã€Œã„ã‚ˆã„ã‚ˆã€ã¾ã™ã¾ã™ã€ã®æ„å‘³ã€‚ã€Œç”Ÿï¼ˆãŠã„ï¼‰ã€ã¯ã€Œç”Ÿã„èŒ‚ã‚‹ã€ã€‚ã¤ã¾ã‚Šã€Œè‰æœ¨ãŒã„ã‚ˆã„ã‚ˆç”Ÿã„èŒ‚ã‚‹æœˆã€ã¨ã„ã†æ„å‘³ã§ã™ã€‚

â— ãªãœæ¡œã¯æ—¥æœ¬ã®è±¡å¾´ï¼Ÿ

å¤æ¥ã€æ¡œã¯ã€Œç”°ã®ç¥ãŒå®¿ã‚‹æœ¨ã€ã¨ã•ã‚Œã€èŠ±ã®å’²ãå…·åˆã§è±Šä½œã‚’å ã„ã¾ã—ãŸã€‚ã€Œã•ãã‚‰ã€ã¯ã€Œç”°ã®ç¥ï¼ˆã•ï¼‰ã®åº§ï¼ˆãã‚‰ï¼‰ã€ãŒèªæºã¨ã„ã†èª¬ã‚‚ã‚ã‚Šã¾ã™ã€‚"""
        }
        
        base = trivia_data.get(lunar_month_name, f"{lunar_month_name}ã«ã¾ã¤ã‚ã‚‹æ–‡åŒ–é›‘å­¦")
        
        return f"""<h3 style="color: #2d3748; font-size: 26px; margin-bottom: 25px; border-left: 6px solid #4299e1; padding-left: 15px;">ğŸ’¡ æš¦ã«ã¾ã¤ã‚ã‚‹æ–‡åŒ–é›‘å­¦</h3>
<div style="background: #ebf8ff; padding: 28px; border-radius: 12px; margin-bottom: 30px;">
<p style="margin: 0; color: #1e40af; line-height: 2; font-size: 16px; white-space: pre-line;">{base}</p>
</div>"""
    
    def _generate_nature_section(self, sekki, kou):
        """è‡ªç„¶ã¨æ°—è±¡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå­£ç¯€å¯¾å¿œï¼‰"""
        nature_text = self.data_provider.get_nature_changes(self.month, self.day, sekki, kou)
        
        if self.gemini:
            enhanced = self.gemini.enhance_text("è‡ªç„¶ã¨æ°—è±¡", nature_text, f"{sekki[0]}ã®è‡ªç„¶")
        else:
            enhanced = nature_text
        
        return f"""<h3 style="color: #2d3748; font-size: 26px; margin-bottom: 25px; border-left: 6px solid #38b2ac; padding-left: 15px;">ğŸ è‡ªç„¶ã¨æ°—è±¡æƒ…å ±</h3>
<div style="background: linear-gradient(135deg, #e6fffa, #b2f5ea); padding: 28px; border-radius: 12px; margin-bottom: 30px;">
<p style="margin: 0; color: #234e52; line-height: 2; font-size: 16px; white-space: pre-line;">{enhanced}</p>
</div>"""
    
    def _generate_food_section(self):
        """æ—¬ã®é£Ÿæã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæœˆå¯¾å¿œï¼‰"""
        food_data = {
            12: """â—æ—¬ã®ã‚‚ã®

é°¤ï¼ˆã¶ã‚Šï¼‰ãƒ»é±ˆï¼ˆãŸã‚‰ï¼‰ãƒ»ç‰¡è £ãƒ»ãµããƒ»ã‚ã‚“ã“ã†

ç™½èœãƒ»å¤§æ ¹ãƒ»ã­ããƒ»ã‹ã¶ãƒ»æ˜¥èŠ

ã‚†ãšãƒ»ã¿ã‹ã‚“ãƒ»ã‚Šã‚“ã”

ç‰¹ã«å¯’ã¶ã‚Šã¯è„‚ãŒã®ã‚Šã€æ—¥æœ¬æµ·å´ã§ã¯"å¹´å–ã‚Šé­š"ã¨ã—ã¦é‡å®ã•ã‚Œã¦ãã¾ã—ãŸã€‚

â—æ—¬ã®æ–™ç†ãƒ»ä¿å­˜é£Ÿ

ãŠã§ã‚“ã€é‹ç‰©ã€ã¶ã‚Šå¤§æ ¹

åˆ‡ã‚Šå¹²ã—å¤§æ ¹ã€ãŸãã‚ã‚“

é­šã®ç²•æ¼¬ã‘ã€å¹´è¶Šã—ãã°""",
            
            1: """â—æ—¬ã®ã‚‚ã®

å¯’ãƒ–ãƒªãƒ»é±ˆãƒ»ç‰¡è £ãƒ»ãµããƒ»ã‚ã‚“ã“ã†

ç™½èœãƒ»ãƒã‚®ãƒ»å¤§æ ¹ãƒ»ã»ã†ã‚Œã‚“è‰ãƒ»æ˜¥èŠ

ã¿ã‹ã‚“ãƒ»ã‚Šã‚“ã”ãƒ»ã„ã¡ã”

å¯’ã•ã§ç”˜ã¿ãŒå¢—ã—ãŸé‡èœãŒç¾å‘³ã€‚é‹æ–™ç†ãŒä¸€å±¤ç¾å‘³ã—ããªã‚Šã¾ã™ã€‚

â—è¡Œäº‹é£Ÿ

ä¸ƒè‰ç²¥ï¼ˆ1æœˆ7æ—¥ï¼‰ã€é¡é–‹ãã®é¤…ã€å°è±†ç²¥ï¼ˆå°æ­£æœˆï¼‰

ãŠã›ã¡æ–™ç†ã€é›‘ç…®""",
            
            2: """â—æ—¬ã®ã‚‚ã®

é°†ï¼ˆã•ã‚ã‚‰ï¼‰ãƒ»ã‚ã‹ã‚ãƒ»ç‰¡è £ãƒ»ã‚ã‚“ã“ã†

ç™½èœãƒ»ãƒã‚®ãƒ»ãƒ–ãƒ­ãƒƒã‚³ãƒªãƒ¼ãƒ»ã»ã†ã‚Œã‚“è‰

ã„ã¡ã”ãƒ»ã‚­ã‚¦ã‚¤ãƒ»ã¯ã£ã•ã

ã¾ã å¯’ã„ã§ã™ãŒã€æ˜¥ã®èµ°ã‚Šã®é£Ÿæã‚‚å‡ºå§‹ã‚ã¾ã™ã€‚

â—è¡Œäº‹é£Ÿ

ç¯€åˆ†ã®æµæ–¹å·»ã€ç¦è±†""",
            
            3: """â—æ—¬ã®ã‚‚ã®

æ¡œé¯›ãƒ»ãƒ›ã‚¿ãƒ«ã‚¤ã‚«ãƒ»ã‚ã•ã‚Šãƒ»ã—ã‚‰ã™ãƒ»é°†

èœã®èŠ±ãƒ»æ˜¥ã‚­ãƒ£ãƒ™ãƒ„ãƒ»æ–°ç‰ã­ããƒ»ãŸã‘ã®ã“ãƒ»ãµãã®ã¨ã†

ã„ã¡ã”ãƒ»ãƒ‡ã‚³ãƒãƒ³ãƒ»ã¯ã£ã•ã

æ˜¥ã®æ¯å¹ã‚’æ„Ÿã˜ã‚‹å±±èœã‚„æ–°é‡èœãŒå‡ºå›ã‚Šå§‹ã‚ã¾ã™ã€‚

â—è¡Œäº‹é£Ÿ

ã²ãªç¥­ã‚Šã®ã¡ã‚‰ã—å¯¿å¸ã€è±é¤…ã€ã²ãªã‚ã‚‰ã‚Œ

æ˜¥ã®ãŠå½¼å²¸ã®ã¼ãŸã‚‚ã¡"""
        }
        
        base = food_data.get(self.month, "å­£ç¯€ã®æ—¬ã®é£Ÿæ")
        
        if self.gemini:
            enhanced = self.gemini.enhance_text("æ—¬ã®é£Ÿæ", base, f"{self.month}æœˆã®é£Ÿ")
        else:
            enhanced = base
        
        return f"""<h3 style="color: #2d3748; font-size: 26px; margin-bottom: 25px; border-left: 6px solid #f56565; padding-left: 15px;">ğŸ´ æ—¬ã®é£Ÿæãƒ»è¡Œäº‹é£Ÿ</h3>
<div style="background: linear-gradient(135deg, #fff5f5, #fed7d7); padding: 28px; border-radius: 12px; margin-bottom: 30px;">
<p style="margin: 0; color: #742a2a; line-height: 2; font-size: 16px; white-space: pre-line;">{enhanced}</p>
</div>"""
    
    def _generate_flower_section(self):
        """å­£ç¯€ã®èŠ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæœˆå¯¾å¿œï¼‰"""
        flower_data = {
            12: """æ¤¿ï¼ˆã¤ã°ãï¼‰
èŠ±è¨€è‘‰ï¼šæ§ãˆã‚ãªå„ªã—ã•ãƒ»èª‡ã‚Š
å¯’ã•ã«ã‚‚è² ã‘ãšå’²ãå†¬ã®èŠ±ã€‚èµ¤ã„èŠ±ãŒé›ªæ™¯è‰²ã«æ˜ ãˆã¾ã™ã€‚

å—å¤©ï¼ˆãªã‚“ã¦ã‚“ï¼‰
èŠ±è¨€è‘‰ï¼šè‰¯ã„å®¶åº­
ã€Œé›£ã‚’è»¢ãšã‚‹ã€ã«é€šã˜ã€æ­£æœˆé£¾ã‚Šã«ã‚‚ä½¿ã‚ã‚Œã‚‹ç¸èµ·ç‰©ã€‚

æ°´ä»™ï¼ˆã™ã„ã›ã‚“ï¼‰
èŠ±è¨€è‘‰ï¼šè‡ªå·±æ„›ãƒ»ç¥ç§˜
æ¸…æ¥šãªé¦™ã‚Šã®å†¬ã®èŠ±ã€‚å‡›ã¨å’²ãå§¿ãŒç¾ã—ã„ã€‚""",
            
            1: """ç¦å¯¿è‰ï¼ˆãµãã˜ã‚…ãã†ï¼‰
èŠ±è¨€è‘‰ï¼šå¹¸ã›ã‚’æ‹›ããƒ»æ°¸ä¹…ã®å¹¸ç¦
é›ªè§£ã‘ã¨ã¨ã‚‚ã«å’²ãæ˜¥ã®ä½¿è€…ã€‚é»„é‡‘è‰²ã®èŠ±ãŒæ–°æ˜¥ã‚’ç¥ã„ã¾ã™ã€‚

æ¢…ï¼ˆã†ã‚ï¼‰
èŠ±è¨€è‘‰ï¼šé«˜æ½”ãƒ»å¿è€ãƒ»ç¾
æ—©æ˜¥ã«å’²ãé¦™ã‚Šé«˜ã„èŠ±ã€‚å¯’ã•ã«è² ã‘ãšæ˜¥ã‚’å‘Šã’ã¾ã™ã€‚

æ°´ä»™ï¼ˆã™ã„ã›ã‚“ï¼‰
èŠ±è¨€è‘‰ï¼šè‡ªå·±æ„›ãƒ»ç¥ç§˜
æ¸…æ¥šãªé¦™ã‚Šã®å†¬ã®èŠ±ã€‚""",
            
            2: """æ¢…ï¼ˆã†ã‚ï¼‰
èŠ±è¨€è‘‰ï¼šé«˜æ½”ãƒ»å¿è€ãƒ»ç¾
æ—©æ˜¥ã«å’²ãé¦™ã‚Šé«˜ã„èŠ±ã€‚ã¾ã å¯’ã„ä¸­ã€æ˜¥ã®è¨ªã‚Œã‚’å‘Šã’ã¾ã™ã€‚

ç¦å¯¿è‰ï¼ˆãµãã˜ã‚…ãã†ï¼‰
èŠ±è¨€è‘‰ï¼šå¹¸ã›ã‚’æ‹›ã
æ–°æ˜¥ã‚’å‘Šã’ã‚‹é»„é‡‘ã®èŠ±ã€‚

ã‚¹ãƒãƒ¼ãƒ‰ãƒ­ãƒƒãƒ—
èŠ±è¨€è‘‰ï¼šå¸Œæœ›ãƒ»æ…°ã‚
é›ªã®ä¸­ã§ã‚‚å’²ãå°ã•ãªç™½ã„èŠ±ã€‚""",
            
            3: """æ¡œï¼ˆã•ãã‚‰ï¼‰
èŠ±è¨€è‘‰ï¼šç²¾ç¥ã®ç¾ãƒ»å„ªç¾ãªå¥³æ€§
æ—¥æœ¬ã®æ˜¥ã‚’ä»£è¡¨ã™ã‚‹èŠ±ã€‚æº€é–‹ã®æ¡œã¯æ—¥æœ¬äººã®å¿ƒã‚’é­…äº†ã—ç¶šã‘ã¾ã™ã€‚

èœã®èŠ±ï¼ˆãªã®ã¯ãªï¼‰
èŠ±è¨€è‘‰ï¼šå¿«æ´»ãƒ»æ˜ã‚‹ã•
æ˜¥ã®é‡ã‚’é»„è‰²ãæŸ“ã‚ã‚‹ã€‚

ãƒãƒ¥ãƒ¼ãƒªãƒƒãƒ—
èŠ±è¨€è‘‰ï¼šæ€ã„ã‚„ã‚Š
æ˜¥ã®èŠ±å£‡ã‚’å½©ã‚‹ä»£è¡¨èŠ±ã€‚"""
        }
        
        base = flower_data.get(self.month, "å­£ç¯€ã®èŠ±")
        
        return f"""<h3 style="color: #2d3748; font-size: 26px; margin-bottom: 25px; border-left: 6px solid #f687b3; padding-left: 15px;">ğŸŒ¸ å­£ç¯€ã®è‰æœ¨ã¨èŠ±è¨€è‘‰</h3>
<div style="background: linear-gradient(135deg, #fff0f5, #ffe4f3); padding: 28px; border-radius: 12px; margin-bottom: 30px;">
<p style="margin: 0; color: #9f1239; line-height: 2; font-size: 16px; white-space: pre-line;">{base}</p>
</div>"""
    
    def _generate_astronomy_section(self, lunar):
        """å¤©æ–‡æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæœˆé½¢å¯¾å¿œï¼‰"""
        base = f"""æœˆé½¢{lunar['age']}ã®"{lunar['phase']}"
{lunar['appearance']}

æ˜Ÿåº§ã§ã¯ã‚ªãƒªã‚ªãƒ³åº§ãŒå†¬ã®ä¸»å½¹ã€‚ãƒ™ãƒ†ãƒ«ã‚®ã‚¦ã‚¹ã€ãƒªã‚²ãƒ«ã€ä¸‰ã¤æ˜ŸãŒç¾ã—ãè¼ãã¾ã™ã€‚å†¬ã®å¤§ä¸‰è§’ï¼ˆãƒ™ãƒ†ãƒ«ã‚®ã‚¦ã‚¹ãƒ»ã‚·ãƒªã‚¦ã‚¹ãƒ»ãƒ—ãƒ­ã‚­ã‚ªãƒ³ï¼‰ã‚‚è¦‹äº‹ã§ã™ã€‚

é€æ˜åº¦ã®é«˜ã„å†¬ã¯ä¸€å¹´ã§æœ€ã‚‚æ˜Ÿè¦‹ã«å‘ã„ãŸå­£ç¯€ã€‚é˜²å¯’ã‚’ã—ã£ã‹ã‚Šã—ã¦çœºã‚ã¦ã¿ã¦ãã ã•ã„ã€‚"""
        
        return f"""<h3 style="color: #2d3748; font-size: 26px; margin-bottom: 25px; border-left: 6px solid #4299e1; padding-left: 15px;">ğŸŒ• æœˆã‚„æ˜Ÿã®æš¦ãƒ»å¤©æ–‡æƒ…å ±</h3>
<div style="background: linear-gradient(135deg, #ebf4ff, #dbeafe); padding: 28px; border-radius: 12px; margin-bottom: 30px;">
<p style="margin: 0; color: #1e40af; line-height: 2; font-size: 16px; white-space: pre-line;">{base}</p>
</div>"""
    
    def _generate_craft_section(self):
        """ä¼çµ±å·¥èŠ¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå­£ç¯€å¯¾å¿œï¼‰"""
        craft_data = {
            12: """å†¬å ´ã¯å„åœ°ã§**è—ç´°å·¥ï¼ˆã—ã‚ç¸„ãƒ»ã—ã‚é£¾ã‚Šï¼‰**ã¥ãã‚ŠãŒç››ã‚“ã€‚

æ–°æ½Ÿãƒ»ä½æ¸¡ï¼šè—ã‚’ç´°ã‹ãç·¨ã‚€"é¬¼å¤ªé¼“ã®ã—ã‚ç¸„"

å¥ˆè‰¯ï¼šç¥ç¤¾ã®å¤§ã—ã‚ç¸„ã®ä»•è¾¼ã¿ãŒå§‹ã¾ã‚‹

å‡ºé›²ï¼šå‡ºé›²å¤§ç¤¾å½¢å¼ã®å¤§æ³¨é€£ç¸„åˆ¶ä½œè¦‹å­¦ãŒã§ãã‚‹åœ°åŸŸã‚‚

è—ã®é¦™ã‚Šã¯å¹´ç¥æ§˜ã‚’è¿ãˆã‚‹è±¡å¾´ã§ã™ã€‚å¹²ã—æŸ¿ã¥ãã‚Šã€æ›²ã’ã‚ã£ã±ã®å¼å½“ç®±ã¥ãã‚Šã‚‚ç››ã‚“ãªå­£ç¯€ã€‚""",
            
            1: """æ–°æ˜¥ã¯ä¼çµ±å·¥èŠ¸ã®å±•ç¤ºã‚„å®Ÿæ¼”ãŒå„åœ°ã§è¡Œã‚ã‚Œã¾ã™ã€‚

å‡§æšã’ã®å‡§ï¼šå„åœ°ã®ä¼çµ±çš„ãªå’Œå‡§ã¯èŠ¸è¡“ä½œå“

ç¾½å­æ¿ï¼šå¥³ã®å­ã®æ­£æœˆéŠã³ã€å„é™¤ã‘ã®æ„å‘³ã‚‚

æ›¸ãåˆã‚ï¼šæ–°å¹´ã®æŠ±è² ã‚’æ›¸ãç¿’å­—

é¤…ã¤ãï¼šæµã¨è‡¼ã§ã®ä¼çµ±ä½œæ¥­""",
            
            2: """ç«‹æ˜¥ã‚’è¿ãˆã€æ˜¥ã®å·¥èŠ¸å“ã¥ãã‚ŠãŒå§‹ã¾ã‚Šã¾ã™ã€‚

é››äººå½¢ã®è£½ä½œï¼šè·äººã«ã‚ˆã‚‹æ‰‹ä½œæ¥­

æ¡ƒã®ç¯€å¥ã®é£¾ã‚Šç‰©

å’Œç´™ã¥ãã‚Šï¼šæ¢…ã®å­£ç¯€ã«åˆã‚ã›ãŸæŸ„""",
            
            3: """æ˜¥ã®å·¥èŠ¸å“ãŒæœ€ç››æœŸã€‚

é››äººå½¢ã®æœ€çµ‚ä»•ä¸Šã’

æ¡œæŸ“ã‚ã®å¸ƒï¼šæ¡œã®æã§æŸ“ã‚ã‚‹ä¼çµ±æŠ€æ³•

ç«¹ç´°å·¥ï¼šç­ã®å­£ç¯€ã«åˆã‚ã›ãŸç± ã¥ãã‚Š"""
        }
        
        base = craft_data.get(self.month, "ã“ã®å­£ç¯€ã®ä¼çµ±å·¥èŠ¸")
        
        return f"""<h3 style="color: #2d3748; font-size: 26px; margin-bottom: 25px; border-left: 6px solid #ed8936; padding-left: 15px;">ğŸ¨ ä¼çµ±å·¥èŠ¸ãƒ»æ°‘èŠ¸å“</h3>
<div style="background: linear-gradient(135deg, #fffaf0, #feebc8); padding: 28px; border-radius: 12px; margin-bottom: 30px;">
<p style="margin: 0; color: #7c2d12; line-height: 2; font-size: 16px; white-space: pre-line;">{base}</p>
</div>"""
    
    def _generate_festival_section(self):
        """ç¥­äº‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå­£ç¯€å¯¾å¿œï¼‰"""
        festival_data = {
            12: """å†¬ã®ç¥­ã‚Šã®æº–å‚™ãŒæ—¥æœ¬å„åœ°ã§é€²ã¿ã¾ã™ã€‚

å·¦ç¾©é•·ãƒ»ã©ã‚“ã©ç„¼ãã®æº–å‚™

**æ­£æœˆé£¾ã‚Šã‚„é–€æ¾ã®ææ–™ï¼ˆæ¾ãƒ»ç«¹ï¼‰**ã‚’å±±ã«å–ã‚Šã«è¡Œã"æ¾è¿ãˆ"

ç¥ç¤¾ã§ã¯**å¤§ç¥“ï¼ˆãŠãŠã¯ã‚‰ãˆï¼‰**ã®æº–å‚™ãŒã‚¹ã‚¿ãƒ¼ãƒˆ

12æœˆã¯"ç¥“ï¼ˆã¯ã‚‰ãˆï¼‰ã¨è¿ãˆ"ãŒé‡ãªã‚‹ã€ã¨ã¦ã‚‚ç¥è–ãªæœˆã§ã™ã€‚""",
            
            1: """æ–°å¹´ã‚’è¿ãˆã‚‹ç¥­äº‹ãŒå„åœ°ã§ã€‚

åˆè©£ï¼šä¸€å¹´ã®ç„¡äº‹ã‚’ç¥ˆé¡˜

ã©ã‚“ã©ç„¼ãï¼šæ­£æœˆé£¾ã‚Šã‚’ç„šãä¸Šã’ã‚‹

å°æ­£æœˆã®ç¥­ã‚Šï¼š1æœˆ15æ—¥å‰å¾Œ

å¯’ä¸­ã®ä¿®è¡Œï¼šå¯’ç¨½å¤ã€å¯’ä¸­æ°´æ³³ãªã©""",
            
            2: """ç¯€åˆ†ã®ç¥­äº‹ãŒä¸­å¿ƒã€‚

ç¯€åˆ†ç¥­ï¼šå„ç¥ç¤¾ã§è±†ã¾ã

åˆåˆç¥­ï¼šç¨²è·ç¥ç¤¾ã®ç¥­ã‚Š

é‡ä¾›é¤Šï¼šæŠ˜ã‚ŒãŸé‡ã‚’ä¾›é¤Šã™ã‚‹""",
            
            3: """æ˜¥ã®è¨ªã‚Œã‚’ç¥ã†ç¥­äº‹ã€‚

æ˜¥ç¥­ã‚Šï¼šå„åœ°ã§é–‹å‚¬

é››ç¥­ã‚Šï¼šå¥³ã®å­ã®å¥ã‚„ã‹ãªæˆé•·ã‚’é¡˜ã†

æ˜¥ã®å½¼å²¸ï¼šå…ˆç¥–ä¾›é¤Š

èŠ±è¦‹ï¼šæ¡œã®ä¸‹ã§ã®å®´"""
        }
        
        base = festival_data.get(self.month, "ã“ã®å­£ç¯€ã®ç¥­äº‹")
        
        return f"""<h3 style="color: #2d3748; font-size: 26px; margin-bottom: 25px; border-left: 6px solid #805ad5; padding-left: 15px;">ğŸ“– ç¥­äº‹ã®èƒŒæ™¯ã‚„ç¥è©±ä¼èª¬</h3>
<div style="background: linear-gradient(135deg, #faf5ff, #e9d8fd); padding: 28px; border-radius: 12px; margin-bottom: 30px;">
<p style="margin: 0; color: #44337a; line-height: 2; font-size: 16px; white-space: pre-line;">{base}</p>
</div>"""
    
    def _generate_arts_section(self):
        """ä¼çµ±èŠ¸èƒ½ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå­£ç¯€å¯¾å¿œï¼‰"""
        arts_data = {
            12: """ã“ã®æ™‚æœŸã¯å„åœ°ã§

**èƒ½ã®ã€Œç¾½è¡£ã€ã‚„ã€Œé«˜ç ‚ã€**ãªã©ã€æ–°å¹´ã‚’å¯¿ãæ¼”ç›®ã®æº–å‚™

é›…æ¥½ã®èª¿ã¹ã‚’å¥‰ç´ã™ã‚‹å¹´æœ«ç¥­å„€

æ­Œèˆä¼åº§ã§ã¯ã€ŒåäºŒæœˆå¤§æ­Œèˆä¼ã€ãŒé–‹å‚¬ã•ã‚Œã€æ–°å¹´ã‚’è¿ãˆã‚‹è¯ã‚„ã‹ãªæ¼”ç›®ãŒä¸Šæ¼”ã•ã‚Œã¾ã™ã€‚""",
            
            1: """æ–°æ˜¥ã‚’ç¥ã†èŠ¸èƒ½ãŒå„åœ°ã§ã€‚

**èƒ½ã®ã€Œç¿ã€**ï¼šæ–°å¹´ã‚’ç¥ã†æœ€ã‚‚æ ¼å¼é«˜ã„æ¼”ç›®

**æ­Œèˆä¼ã€Œå¯¿æ›½æˆ‘å¯¾é¢ã€**ï¼šæ­£æœˆã®å®šç•ªæ¼”ç›®

ç…å­èˆï¼šå„åœ°ã§æ­£æœˆã«æŠ«éœ²

åˆæ˜¥ã®ç´ãƒ»ä¸‰å‘³ç·šã®æ¼”å¥ä¼š""",
            
            2: """æ—©æ˜¥ã®èŠ¸èƒ½ã€‚

æ¢…è¦‹ã®èƒ½æ¥½å…¬æ¼”

æ­Œèˆä¼ã€Œè…åŸä¼æˆæ‰‹ç¿’é‘‘ã€ï¼šæ˜¥ã®åä½œ

é››ã®ç¯€å¥ã«åˆã‚ã›ãŸèˆè¸Šå…¬æ¼”""",
            
            3: """æ˜¥ã‚’ç¥ã†èŠ¸èƒ½ãŒèŠ±ç››ã‚Šã€‚

èŠ±è¦‹ã®èƒ½æ¥½å…¬æ¼”

æ­Œèˆä¼ã€Œç¾©çµŒåƒæœ¬æ¡œã€ï¼šæ˜¥ã®ä»£è¡¨ä½œ

æ˜¥ã®æ­Œèˆä¼å…¬æ¼”ï¼šå„åœ°ã§é–‹å‚¬"""
        }
        
        base = arts_data.get(self.month, "ã“ã®å­£ç¯€ã®ä¼çµ±èŠ¸èƒ½")
        
        return f"""<h3 style="color: #2d3748; font-size: 26px; margin-bottom: 25px; border-left: 6px solid #d53f8c; padding-left: 15px;">ğŸ¼ ä¼çµ±èŠ¸èƒ½</h3>
<div style="background: linear-gradient(135deg, #fff5f7, #fed7e2); padding: 28px; border-radius: 12px; margin-bottom: 35px;">
<p style="margin: 0; color: #702459; line-height: 2; font-size: 16px; white-space: pre-line;">{base}</p>
</div>"""


class BloggerPoster:
    """BloggeræŠ•ç¨¿ã‚¯ãƒ©ã‚¹"""
    
    def __init__(self):
        self.credentials = None
        self.service = None
    
    def authenticate(self):
        """Google APIèªè¨¼"""
        creds = None
        
        if os.environ.get('GOOGLE_TOKEN'):
            token_data = json.loads(os.environ['GOOGLE_TOKEN'])
            creds = Credentials.from_authorized_user_info(token_data, SCOPES)
        
        if not creds or not creds.valid:
            if creds and creds.expired and creds.refresh_token:
                creds.refresh(Request())
            else:
                if os.environ.get('GOOGLE_CREDENTIALS'):
                    creds_data = json.loads(os.environ['GOOGLE_CREDENTIALS'])
                    flow = InstalledAppFlow.from_client_config(creds_data, SCOPES)
                    creds = flow.run_local_server(port=0)
                else:
                    raise Exception("èªè¨¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
        
        self.credentials = creds
        self.service = build('blogger', 'v3', credentials=creds)
    
    def post_to_blog(self, blog_id, title, content, labels):
        """Bloggerã«æŠ•ç¨¿"""
        try:
            post = {
                'kind': 'blogger#post',
                'title': title,
                'content': content,
                'labels': labels
            }
            
            request = self.service.posts().insert(blogId=blog_id, body=post)
            response = request.execute()
            
            print(f"âœ“ æŠ•ç¨¿æˆåŠŸ: {response.get('url')}")
            return response
        except Exception as e:
            print(f"âœ— æŠ•ç¨¿ã‚¨ãƒ©ãƒ¼: {str(e)}")
            raise


def main():
    """ãƒ¡ã‚¤ãƒ³å‡¦ç†"""
    try:
        blog_id = os.environ.get('BLOG_ID')
        gemini_key = os.environ.get('GEMINI_API_KEY')
        
        if not blog_id:
            raise Exception("BLOG_IDç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“")
        
        print("=" * 70)
        print("æš¦æƒ…å ±è‡ªå‹•æŠ•ç¨¿ã‚·ã‚¹ãƒ†ãƒ  - å®Œå…¨ç‰ˆï¼ˆæ—¥ä»˜å¯¾å¿œï¼‰")
        print("=" * 70)
        jst = ZoneInfo('Asia/Tokyo')
        now = datetime.now(jst)
        print(f"å®Ÿè¡Œæ—¥æ™‚: {now.strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M:%S')}")
        print(f"Gemini API: {'æœ‰åŠ¹ï¼ˆæ–‡ç« å……å®Ÿãƒ¢ãƒ¼ãƒ‰ï¼‰' if gemini_key else 'ç„¡åŠ¹ï¼ˆåŸºæœ¬ãƒ¢ãƒ¼ãƒ‰ï¼‰'}")
        
        # æš¦æƒ…å ±ç”Ÿæˆ
        print("\næš¦æƒ…å ±ã‚’ç”Ÿæˆä¸­ï¼ˆå…¨14ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ»æ—¥ä»˜å¯¾å¿œï¼‰...")
        generator = ComprehensiveCalendarGenerator(target_date=now, gemini_api_key=gemini_key)
        post_data = generator.generate_full_html()
        
        print(f"âœ“ ã‚¿ã‚¤ãƒˆãƒ«: {post_data['title']}")
        print(f"âœ“ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚µã‚¤ã‚º: {len(post_data['content'])} æ–‡å­—")
        print(f"âœ“ ãƒ©ãƒ™ãƒ«: {', '.join(post_data['labels'])}")
        
        # BloggeræŠ•ç¨¿
        print("\nBloggerã«æŠ•ç¨¿ä¸­...")
        poster = BloggerPoster()
        poster.authenticate()
        poster.post_to_blog(blog_id, post_data['title'], post_data['content'], post_data['labels'])
        
        print("\n" + "=" * 70)
        print("âœ“ ã™ã¹ã¦ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print("=" * 70)
        
    except Exception as e:
        print(f"\nâœ— ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
        import traceback
        traceback.print_exc()
        sys.exit(1)


if __name__ == '__main__':
    main()
