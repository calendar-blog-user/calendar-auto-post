#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æš¦æƒ…å ±è‡ªå‹•æŠ•ç¨¿ã‚·ã‚¹ãƒ†ãƒ  - 365æ—¥æ¯æ—¥é•ã†å†…å®¹ã‚’è‡ªå‹•ç”Ÿæˆ
æ¯æ—¥æ±ºã¾ã£ãŸæ™‚é–“ã«æš¦æƒ…å ±ã‚’Bloggerã«è‡ªå‹•æŠ•ç¨¿
"""

import os
import json
import sys
from datetime import datetime, timedelta
from zoneinfo import ZoneInfo
import calendar
import math
from google.oauth2.credentials import Credentials
from google_auth_oauthlib.flow import InstalledAppFlow
from google.auth.transport.requests import Request
from googleapiclient.discovery import build

# ã‚¹ã‚³ãƒ¼ãƒ—è¨­å®š
SCOPES = ['https://www.googleapis.com/auth/blogger']

class CalendarGenerator:
    """æš¦æƒ…å ±ç”Ÿæˆã‚¯ãƒ©ã‚¹ - 365æ—¥æ¯æ—¥ç•°ãªã‚‹å†…å®¹ã‚’ç”Ÿæˆ"""
    
    def __init__(self, target_date=None):
        self.jst = ZoneInfo("Asia/Tokyo")
        # å¼•æ•°ã§æ—¥ä»˜æŒ‡å®šãŒãªã‘ã‚Œã°ä»Šæ—¥ã®æ—¥ä»˜ã‚’ä½¿ç”¨
        self.target_date = target_date or datetime.now(self.jst)
        
    def get_lunar_calendar(self):
        """æ—§æš¦ã‚’è¨ˆç®— - æ¯æ—¥å¤‰ã‚ã‚Šã¾ã™"""
        year = self.target_date.year
        month = self.target_date.month
        day = self.target_date.day
        
        # æ–°æœˆã®åŸºæº–æ—¥ï¼ˆ2000å¹´1æœˆ6æ—¥ï¼‰
        base_date = datetime(2000, 1, 6, tzinfo=self.jst)
        days_since = (self.target_date - base_date).days
        
        # æœˆé½¢ã‚’è¨ˆç®—ï¼ˆæœ”æœ›æœˆå‘¨æœŸ: 29.530588853æ—¥ï¼‰
        moon_age = days_since % 29.530588853
        
        # æ—§æš¦ã®æœˆã‚’è¨ˆç®—ï¼ˆç°¡æ˜“ç‰ˆï¼‰
        # æ–°æš¦ã¨æ—§æš¦ã®ã‚ºãƒ¬ã‚’è€ƒæ…®
        lunar_offset = -1 if month <= 2 else 0
        lunar_month = ((month + 9 + lunar_offset) % 12) or 12
        
        # æ—§æš¦ã®æ—¥ã‚’æœˆé½¢ã‹ã‚‰æ¨å®š
        lunar_day = int(moon_age) + 1
        if lunar_day > 30:
            lunar_day = 1
            lunar_month = (lunar_month % 12) + 1
        
        # æœˆã®åå‰ã‚’æ±ºå®š
        moon_phase_names = {
            range(0, 2): "æ–°æœˆ",
            range(2, 3): "äºŒæ—¥æœˆ",
            range(3, 4): "ä¸‰æ—¥æœˆ", 
            range(4, 7): "ä¸Šå¼¦ã¸å‘ã‹ã†æœˆ",
            range(7, 9): "ä¸Šå¼¦ã®æœˆ",
            range(9, 13): "åä¸‰å¤œæœˆ",
            range(13, 16): "æº€æœˆ",
            range(16, 18): "åå…­å¤œ",
            range(18, 23): "ä¸‹å¼¦ã¸å‘ã‹ã†æœˆ",
            range(23, 24): "ä¸‹å¼¦ã®æœˆ",
            range(24, 29): "æ™¦æ—¥æœˆ"
        }
        
        moon_name = "æ–°æœˆ"
        moon_age_int = int(moon_age)
        for age_range, name in moon_phase_names.items():
            if moon_age_int in age_range:
                moon_name = name
                break
        
        # æœˆã®è¦‹ãˆæ–¹ã®èª¬æ˜
        moon_descriptions = {
            range(0, 2): "å¤œç©ºã«æœˆã¯è¦‹ãˆã¾ã›ã‚“",
            range(2, 4): "å¤•æ–¹ã®è¥¿ç©ºã«ç´°ã„æœˆ",
            range(4, 8): "å¤•æ–¹ã‹ã‚‰å®µã«å¼“ãªã‚Šã®æœˆ",
            range(8, 14): "å®µã‹ã‚‰å¤œåŠã«è†¨ã‚‰ã‚€æœˆ",
            range(14, 16): "å¤œé€šã—è¼ãä¸¸ã„æœˆ",
            range(16, 23): "å¤œåŠã‹ã‚‰æ˜ã‘æ–¹ã«æ¬ ã‘ã¦ã„ãæœˆ",
            range(23, 30): "æ˜ã‘æ–¹ã®æ±ç©ºã«ç´°ã„æœˆ"
        }
        
        moon_desc = "ç¾ã—ã„æœˆ"
        for age_range, desc in moon_descriptions.items():
            if moon_age_int in age_range:
                moon_desc = desc
                break
        
        return {
            'lunar_month': lunar_month,
            'lunar_day': lunar_day,
            'moon_age': round(moon_age, 1),
            'moon_name': moon_name,
            'moon_description': moon_desc
        }
    
    def get_sekki_and_kou(self):
        """äºŒåå››ç¯€æ°—ã¨ä¸ƒåäºŒå€™ã‚’å–å¾— - æ¯æ—¥æ­£ç¢ºã«å¤‰ã‚ã‚Šã¾ã™"""
        month = self.target_date.month
        day = self.target_date.day
        
        # äºŒåå››ç¯€æ°—ã®å®šç¾©ï¼ˆ2025å¹´åŸºæº–ã€å¹´ã«ã‚ˆã£ã¦Â±1æ—¥å¤‰å‹•ï¼‰
        sekki_dates = [
            (1, 5, "å°å¯’", "å¯’ã•ãŒå³ã—ããªã‚Šå§‹ã‚ã‚‹é ƒ"),
            (1, 20, "å¤§å¯’", "ä¸€å¹´ã§æœ€ã‚‚å¯’ã„æ™‚æœŸ"),
            (2, 3, "ç«‹æ˜¥", "æ˜¥ã®å§‹ã¾ã‚Šã€æš¦ã®ä¸Šã§ã¯æ˜¥"),
            (2, 18, "é›¨æ°´", "é›ªãŒé›¨ã«å¤‰ã‚ã‚Šã€æ°·ãŒè§£ã‘å§‹ã‚ã‚‹"),
            (3, 5, "å•“èŸ„", "å†¬çœ ã—ã¦ã„ãŸè™«ãŒç›®è¦šã‚ã‚‹"),
            (3, 20, "æ˜¥åˆ†", "æ˜¼å¤œã®é•·ã•ãŒã»ã¼ç­‰ã—ããªã‚‹"),
            (4, 4, "æ¸…æ˜", "ä¸‡ç‰©ãŒæ¸…ã‚‰ã‹ã§ç”Ÿãç”Ÿãã™ã‚‹"),
            (4, 20, "ç©€é›¨", "ç©€ç‰©ã‚’è‚²ã¦ã‚‹æ˜¥ã®é›¨ãŒé™ã‚‹"),
            (5, 5, "ç«‹å¤", "å¤ã®å§‹ã¾ã‚Šã€æ–°ç·‘ãŒç›®ã«é®®ã‚„ã‹"),
            (5, 21, "å°æº€", "è‰æœ¨ãŒèŒ‚ã‚Šå¤©åœ°ã«æº€ã¡å§‹ã‚ã‚‹"),
            (6, 5, "èŠ’ç¨®", "éº¦ã‚’åˆˆã‚Šã€ç¨²ã‚’æ¤ãˆã‚‹æ™‚æœŸ"),
            (6, 21, "å¤è‡³", "ä¸€å¹´ã§æœ€ã‚‚æ˜¼ãŒé•·ã„æ—¥"),
            (7, 7, "å°æš‘", "æ¢…é›¨æ˜ã‘é ƒã€æœ¬æ ¼çš„ãªæš‘ã•ã®å§‹ã¾ã‚Š"),
            (7, 22, "å¤§æš‘", "ä¸€å¹´ã§æœ€ã‚‚æš‘ã„æ™‚æœŸ"),
            (8, 7, "ç«‹ç§‹", "ç§‹ã®å§‹ã¾ã‚Šã€æš¦ã®ä¸Šã§ã¯ç§‹"),
            (8, 23, "å‡¦æš‘", "æš‘ã•ãŒå³ ã‚’è¶Šãˆã€æœå¤•ãŒæ¶¼ã—ã"),
            (9, 7, "ç™½éœ²", "è‰æœ¨ã«ç™½ã„éœ²ãŒå®¿ã‚Šå§‹ã‚ã‚‹"),
            (9, 23, "ç§‹åˆ†", "æ˜¼å¤œã®é•·ã•ãŒã»ã¼ç­‰ã—ããªã‚‹"),
            (10, 8, "å¯’éœ²", "éœ²ãŒå†·ãŸãæ„Ÿã˜ã‚‰ã‚Œã‚‹é ƒ"),
            (10, 23, "éœœé™", "æœéœœãŒé™ã‚Šå§‹ã‚ã‚‹é ƒ"),
            (11, 7, "ç«‹å†¬", "å†¬ã®å§‹ã¾ã‚Šã€æš¦ã®ä¸Šã§ã¯å†¬"),
            (11, 22, "å°é›ª", "ã‚ãšã‹ã«é›ªãŒé™ã‚Šå§‹ã‚ã‚‹é ƒ"),
            (12, 7, "å¤§é›ª", "é›ªãŒæœ¬æ ¼çš„ã«é™ã‚Šå§‹ã‚ã‚‹"),
            (12, 21, "å†¬è‡³", "ä¸€å¹´ã§æœ€ã‚‚æ˜¼ãŒçŸ­ã„æ—¥")
        ]
        
        # ç¾åœ¨ã®ç¯€æ°—ã‚’æ¢ã™
        current_sekki = None
        for m, d, name, desc in reversed(sekki_dates):
            if month > m or (month == m and day >= d):
                current_sekki = (name, desc)
                break
        if not current_sekki:
            current_sekki = sekki_dates[-1][2:]
        
        # ä¸ƒåäºŒå€™ã®å®šç¾©ï¼ˆå„ç¯€æ°—ã‚’3ã¤ã«åˆ†ã‘ãŸå€™ï¼‰
        kou_dates = [
            (1, 5, "èŠ¹ä¹ƒæ „", "ã›ã‚Šã™ãªã‚ã¡ã•ã‹ã†", "èŠ¹ãŒç››ã‚“ã«ç”Ÿãˆå§‹ã‚ã‚‹"),
            (1, 10, "æ°´æ³‰å‹•", "ã—ã¿ãšã‚ãŸãŸã‹ã‚’ãµãã‚€", "åœ°ä¸­ã§å‡ã£ãŸæ³‰ãŒå‹•ãå§‹ã‚ã‚‹"),
            (1, 15, "é›‰å§‹é›Š", "ãã˜ã¯ã˜ã‚ã¦ãªã", "é›‰ãŒé³´ãå§‹ã‚ã‚‹"),
            (1, 20, "æ¬¾å†¬è¯", "ãµãã®ã¯ãªã•ã", "è•—ã®èŠ±ãŒå’²ã"),
            (1, 25, "æ°´æ²¢è…¹å …", "ã•ã‚ã¿ãšã“ãŠã‚Šã¤ã‚ã‚‹", "æ²¢ã®æ°´ãŒåšãå‡ã‚‹"),
            (1, 30, "é¶å§‹ä¹³", "ã«ã‚ã¨ã‚Šã¯ã˜ã‚ã¦ã¨ã‚„ã«ã¤ã", "é¶ãŒåµã‚’ç”£ã¿å§‹ã‚ã‚‹"),
            (2, 3, "æ±é¢¨è§£å‡", "ã¯ã‚‹ã‹ãœã“ãŠã‚Šã‚’ã¨ã", "æ˜¥ã®é¢¨ãŒæ°·ã‚’è§£ã‹ã™"),
            (2, 8, "é»„é¶¯çç†", "ã†ãã„ã™ãªã", "é¶¯ãŒé³´ãå§‹ã‚ã‚‹"),
            (2, 13, "é­šä¸Šæ°·", "ã†ãŠã“ãŠã‚Šã‚’ã„ãšã‚‹", "é­šãŒæ°·ã®ä¸‹ã‹ã‚‰ç¾ã‚Œã‚‹"),
            (2, 18, "åœŸè„‰æ½¤èµ·", "ã¤ã¡ã®ã—ã‚‡ã†ã†ã‚‹ãŠã„ãŠã“ã‚‹", "é›¨ãŒé™ã£ã¦åœŸãŒæ½¤ã†"),
            (2, 23, "éœå§‹é†", "ã‹ã™ã¿ã¯ã˜ã‚ã¦ãŸãªã³ã", "éœãŒãŸãªã³ãå§‹ã‚ã‚‹"),
            (2, 28, "è‰æœ¨èŒå‹•", "ãã†ã‚‚ãã‚ã°ãˆã„ãšã‚‹", "è‰æœ¨ãŒèŠ½å¹ãå§‹ã‚ã‚‹"),
            (3, 5, "èŸ„è™«å•“æˆ¸", "ã™ã”ã‚‚ã‚Šã‚€ã—ã¨ã‚’ã²ã‚‰ã", "å†¬çœ ã—ã¦ã„ãŸè™«ãŒå‡ºã¦ãã‚‹"),
            (3, 10, "æ¡ƒå§‹ç¬‘", "ã‚‚ã‚‚ã¯ã˜ã‚ã¦ã•ã", "æ¡ƒã®èŠ±ãŒå’²ãå§‹ã‚ã‚‹"),
            (3, 15, "èœè™«åŒ–è¶", "ãªã‚€ã—ã¡ã‚‡ã†ã¨ãªã‚‹", "é’è™«ãŒè¶ã«ãªã‚‹"),
            (3, 20, "é›€å§‹å·£", "ã™ãšã‚ã¯ã˜ã‚ã¦ã™ãã†", "é›€ãŒå·£ã‚’ä½œã‚Šå§‹ã‚ã‚‹"),
            (3, 25, "æ«»å§‹é–‹", "ã•ãã‚‰ã¯ã˜ã‚ã¦ã²ã‚‰ã", "æ¡œãŒå’²ãå§‹ã‚ã‚‹"),
            (3, 30, "é›·ä¹ƒç™ºå£°", "ã‹ã¿ãªã‚Šã™ãªã‚ã¡ã“ãˆã‚’ã¯ã£ã™", "é ãã§é›·ã®éŸ³ãŒèã“ãˆå§‹ã‚ã‚‹"),
            (4, 4, "ç„é³¥è‡³", "ã¤ã°ã‚ããŸã‚‹", "ç‡•ãŒå—ã‹ã‚‰æ¸¡ã£ã¦ãã‚‹"),
            (4, 9, "é´»é›åŒ—", "ã“ã†ãŒã‚“ã‹ãˆã‚‹", "é›ãŒåŒ—ã¸å¸°ã‚‹"),
            (4, 14, "è™¹å§‹è¦‹", "ã«ã˜ã¯ã˜ã‚ã¦ã‚ã‚‰ã‚ã‚‹", "é›¨ä¸ŠãŒã‚Šã«è™¹ãŒå‡ºå§‹ã‚ã‚‹"),
            (4, 20, "è‘­å§‹ç”Ÿ", "ã‚ã—ã¯ã˜ã‚ã¦ã—ã‚‡ã†ãš", "è‘¦ãŒèŠ½ã‚’å¹ãå§‹ã‚ã‚‹"),
            (4, 25, "éœœæ­¢å‡ºè‹—", "ã—ã‚‚ã‚„ã‚“ã§ãªãˆã„ãš", "éœœãŒçµ‚ã‚ã‚Šè‹—ãŒè‚²ã¤"),
            (4, 30, "ç‰¡ä¸¹è¯", "ã¼ãŸã‚“ã¯ãªã•ã", "ç‰¡ä¸¹ã®èŠ±ãŒå’²ã"),
            (5, 5, "è›™å§‹é³´", "ã‹ã‚ãšã¯ã˜ã‚ã¦ãªã", "è›™ãŒé³´ãå§‹ã‚ã‚‹"),
            (5, 10, "èš¯èš“å‡º", "ã¿ã¿ãšã„ãšã‚‹", "èš¯èš“ãŒåœ°ä¸Šã«å‡ºã¦ãã‚‹"),
            (5, 15, "ç«¹ç¬‹ç”Ÿ", "ãŸã‘ã®ã“ã—ã‚‡ã†ãš", "ç­ãŒç”Ÿãˆã¦ãã‚‹"),
            (5, 21, "èš•èµ·é£Ÿæ¡‘", "ã‹ã„ã“ãŠãã¦ãã‚ã‚’ã¯ã‚€", "èš•ãŒæ¡‘ã®è‘‰ã‚’ç››ã‚“ã«é£Ÿã¹ã‚‹"),
            (5, 26, "ç´…èŠ±æ „", "ã¹ã«ã°ãªã•ã‹ã†", "ç´…èŠ±ãŒç››ã‚“ã«å’²ã"),
            (5, 31, "éº¦ç§‹è‡³", "ã‚€ãã®ã¨ãã„ãŸã‚‹", "éº¦ãŒç†Ÿã—åç©«æœŸã‚’è¿ãˆã‚‹"),
            (6, 5, "èŸ·è‚ç”Ÿ", "ã‹ã¾ãã‚Šã—ã‚‡ã†ãš", "èŸ·è‚ãŒç”Ÿã¾ã‚Œã‚‹"),
            (6, 10, "è…è‰ç‚ºè›", "ãã•ã‚ŒãŸã‚‹ãã•ã»ãŸã‚‹ã¨ãªã‚‹", "è›ãŒå…‰ã‚Šå§‹ã‚ã‚‹"),
            (6, 16, "æ¢…å­é»„", "ã†ã‚ã®ã¿ãã°ã‚€", "æ¢…ã®å®ŸãŒé»„ã°ã‚€"),
            (6, 21, "ä¹ƒæ±æ¯", "ãªã¤ã‹ã‚Œãã•ã‹ã‚‹ã‚‹", "å¤æ¯è‰ãŒæ¯ã‚Œã‚‹"),
            (6, 26, "è–è’²è¯", "ã‚ã‚„ã‚ã¯ãªã•ã", "è–è’²ã®èŠ±ãŒå’²ã"),
            (7, 2, "åŠå¤ç”Ÿ", "ã¯ã‚“ã’ã—ã‚‡ã†ãš", "çƒæŸ„æ“ãŒç”Ÿãˆã‚‹"),
            (7, 7, "æ¸©é¢¨è‡³", "ã‚ã¤ã‹ãœã„ãŸã‚‹", "æš‘ã„é¢¨ãŒå¹ã"),
            (7, 12, "è“®å§‹é–‹", "ã¯ã™ã¯ã˜ã‚ã¦ã²ã‚‰ã", "è“®ã®èŠ±ãŒé–‹ãå§‹ã‚ã‚‹"),
            (7, 17, "é·¹ä¹ƒå­¦ç¿’", "ãŸã‹ã™ãªã‚ã¡ã‚ã–ã‚’ãªã‚‰ã†", "é·¹ã®å¹¼é³¥ãŒé£›ã³æ–¹ã‚’å­¦ã¶"),
            (7, 22, "æ¡å§‹çµèŠ±", "ãã‚Šã¯ã˜ã‚ã¦ã¯ãªã‚’ã‚€ã™ã¶", "æ¡ã®èŠ±ãŒå®Ÿã‚’çµã¶"),
            (7, 28, "åœŸæ½¤æº½æš‘", "ã¤ã¡ã†ã‚‹ãŠã†ã¦ã‚€ã—ã‚ã¤ã—", "åœŸãŒæ¹¿ã£ã¦è’¸ã—æš‘ã„"),
            (8, 2, "å¤§é›¨æ™‚è¡Œ", "ãŸã„ã†ã¨ãã©ããµã‚‹", "æ™‚ã¨ã—ã¦å¤§é›¨ãŒé™ã‚‹"),
            (8, 7, "æ¶¼é¢¨è‡³", "ã™ãšã‹ãœã„ãŸã‚‹", "æ¶¼ã—ã„é¢¨ãŒå¹ãå§‹ã‚ã‚‹"),
            (8, 12, "å¯’è‰é³´", "ã²ãã‚‰ã—ãªã", "èœ©ãŒé³´ãå§‹ã‚ã‚‹"),
            (8, 17, "è’™éœ§å‡é™", "ãµã‹ããã‚Šã¾ã¨ã†", "æ·±ã„éœ§ãŒã¾ã¨ã‚ã‚Šã¤ã"),
            (8, 23, "ç¶¿æŸé–‹", "ã‚ãŸã®ã¯ãªã—ã¹ã²ã‚‰ã", "ç¶¿ã®èŠ±ã®ãŒããŒé–‹ã"),
            (8, 28, "å¤©åœ°å§‹ç²›", "ã¦ã‚“ã¡ã¯ã˜ã‚ã¦ã•ã‚€ã—", "å¤©åœ°ã®æš‘ã•ãŒåã¾ã‚Šå§‹ã‚ã‚‹"),
            (9, 2, "ç¦¾ä¹ƒç™»", "ã“ãã‚‚ã®ã™ãªã‚ã¡ã¿ã®ã‚‹", "ç¨²ãŒå®Ÿã‚‹"),
            (9, 7, "è‰éœ²ç™½", "ãã•ã®ã¤ã‚†ã—ã‚ã—", "è‰ã«é™ã‚ŠãŸéœ²ãŒç™½ãè¦‹ãˆã‚‹"),
            (9, 12, "é¶ºé´’é³´", "ã›ãã‚Œã„ãªã", "é¶ºé´’ãŒé³´ãå§‹ã‚ã‚‹"),
            (9, 17, "ç„é³¥å»", "ã¤ã°ã‚ã•ã‚‹", "ç‡•ãŒå—ã¸å¸°ã‚‹"),
            (9, 23, "é›·ä¹ƒåå£°", "ã‹ã¿ãªã‚Šã™ãªã‚ã¡ã“ãˆã‚’ãŠã•ã‚€", "é›·ãŒé³´ã‚‰ãªããªã‚‹"),
            (9, 28, "èŸ„è™«åæˆ¸", "ã‚€ã—ã‹ãã‚Œã¦ã¨ã‚’ãµã•ã", "è™«ãŒåœŸã®ä¸­ã«éš ã‚Œã‚‹"),
            (10, 3, "æ°´å§‹æ¶¸", "ã¿ãšã¯ã˜ã‚ã¦ã‹ã‚‹ã‚‹", "ç”°ã®æ°´ã‚’æŠœãå§‹ã‚ã‚‹"),
            (10, 8, "é´»é›æ¥", "ã“ã†ãŒã‚“ããŸã‚‹", "é›ãŒæ¸¡ã£ã¦ãã‚‹"),
            (10, 13, "èŠèŠ±é–‹", "ããã®ã¯ãªã²ã‚‰ã", "èŠã®èŠ±ãŒå’²ã"),
            (10, 18, "èŸ‹èŸ€åœ¨æˆ¸", "ãã‚Šãã‚Šã™ã¨ã«ã‚ã‚Š", "èŸ‹èŸ€ãŒæˆ¸å£ã§é³´ã"),
            (10, 23, "éœœå§‹é™", "ã—ã‚‚ã¯ã˜ã‚ã¦ãµã‚‹", "éœœãŒé™ã‚Šå§‹ã‚ã‚‹"),
            (10, 28, "éœæ™‚æ–½", "ã“ã•ã‚ã¨ãã©ããµã‚‹", "å°é›¨ãŒã—ã¨ã—ã¨é™ã‚‹"),
            (11, 2, "æ¥“è”¦é»„", "ã‚‚ã¿ã˜ã¤ãŸãã°ã‚€", "ç´…è‘‰ã‚„è”¦ãŒé»„è‘‰ã™ã‚‹"),
            (11, 7, "å±±èŒ¶å§‹é–‹", "ã¤ã°ãã¯ã˜ã‚ã¦ã²ã‚‰ã", "å±±èŒ¶èŠ±ãŒå’²ãå§‹ã‚ã‚‹"),
            (11, 12, "åœ°å§‹å‡", "ã¡ã¯ã˜ã‚ã¦ã“ãŠã‚‹", "å¤§åœ°ãŒå‡ã‚Šå§‹ã‚ã‚‹"),
            (11, 17, "é‡‘ç›é¦™", "ãã‚“ã›ã‚“ã‹ã•ã", "æ°´ä»™ã®èŠ±ãŒå’²ã"),
            (11, 22, "è™¹è”µä¸è¦‹", "ã«ã˜ã‹ãã‚Œã¦ã¿ãˆãš", "è™¹ã‚’è¦‹ã‹ã‘ãªããªã‚‹"),
            (11, 27, "æœ”é¢¨æ‰•è‘‰", "ããŸã‹ãœã“ã®ã¯ã‚’ã¯ã‚‰ã†", "åŒ—é¢¨ãŒæœ¨ã®è‘‰ã‚’æ‰•ã„è½ã¨ã™"),
            (12, 2, "æ©˜å§‹é»„", "ãŸã¡ã°ãªã¯ã˜ã‚ã¦ãã°ã‚€", "æ©˜ã®å®ŸãŒé»„è‰²ããªã‚‹"),
            (12, 7, "é–‰å¡æˆå†¬", "ãã‚‰ã•ã‚€ããµã‚†ã¨ãªã‚‹", "å¤©åœ°ã®æ°—ãŒå¡ãŒã‚Šå†¬ã«ãªã‚‹"),
            (12, 12, "ç†ŠèŸ„ç©´", "ãã¾ã‚ãªã«ã“ã‚‚ã‚‹", "ç†ŠãŒå†¬çœ ã®ãŸã‚ã«ç©´ã«å…¥ã‚‹"),
            (12, 16, "é±–é­šç¾¤", "ã•ã‘ã®ã†ãŠã‚€ã‚‰ãŒã‚‹", "é®­ãŒç¾¤ãŒã£ã¦å·ã‚’ä¸Šã‚‹"),
            (12, 21, "ä¹ƒæ±ç”Ÿ", "ãªã¤ã‹ã‚Œãã•ã—ã‚‡ã†ãš", "å¤æ¯è‰ãŒèŠ½ã‚’å‡ºã™"),
            (12, 26, "éº‹è§’è§£", "ã•ã‚ã—ã‹ã¤ã®ãŠã¤ã‚‹", "å¤§é¹¿ãŒè§’ã‚’è½ã¨ã™"),
            (12, 31, "é›ªä¸‹å‡ºéº¦", "ã‚†ãã‚ãŸã‚Šã¦ã‚€ãã®ã³ã‚‹", "é›ªã®ä¸‹ã§éº¦ãŒèŠ½ã‚’å‡ºã™")
        ]
        
        # ç¾åœ¨ã®å€™ã‚’æ¢ã™
        current_kou = None
        for m, d, name, reading, desc in reversed(kou_dates):
            if month > m or (month == m and day >= d):
                current_kou = (name, reading, desc)
                break
        if not current_kou:
            current_kou = kou_dates[-1][2:]
        
        return {
            'sekki': current_sekki,
            'kou': current_kou
        }
    
    def get_seasonal_info(self):
        """å­£ç¯€ã®æƒ…å ±ã‚’å–å¾— - æœˆã”ã¨ã«å¤‰ã‚ã‚Šã¾ã™"""
        month = self.target_date.month
        
        # æ—¬ã®é£Ÿæï¼ˆæœˆã”ã¨ï¼‰
        seasonal_foods = {
            1: ["ç™½èœ", "ãƒã‚®", "å°æ¾èœ", "å¤§æ ¹", "ã¿ã‹ã‚“", "é‡‘æŸ‘", "é±ˆ", "å¯’ãƒ–ãƒª", "ç‰¡è £", "ã‚ã‚“ã“ã†"],
            2: ["ç™½èœ", "ãƒã‚®", "ãƒ–ãƒ­ãƒƒã‚³ãƒªãƒ¼", "ã‚«ãƒªãƒ•ãƒ©ãƒ¯ãƒ¼", "ã„ã¡ã”", "ã‚­ã‚¦ã‚¤", "é°†", "ã‚ã‹ã‚", "ç‰¡è £"],
            3: ["èœã®èŠ±", "æ˜¥ã‚­ãƒ£ãƒ™ãƒ„", "æ–°ç‰ã­ã", "ã‚¢ã‚¹ãƒ‘ãƒ©ã‚¬ã‚¹", "ã„ã¡ã”", "ãƒ‡ã‚³ãƒãƒ³", "æ¡œé¯›", "ãƒ›ã‚¿ãƒ«ã‚¤ã‚«", "ã‚ã•ã‚Š"],
            4: ["ç­", "æ–°ã˜ã‚ƒãŒã„ã‚‚", "æ˜¥ã‚­ãƒ£ãƒ™ãƒ„", "ãã‚‰è±†", "ã„ã¡ã”", "ã‚°ãƒ¬ãƒ¼ãƒ—ãƒ•ãƒ«ãƒ¼ãƒ„", "åˆé°¹", "æ¡œãˆã³", "ã‚ã•ã‚Š"],
            5: ["æ–°ç‰ã­ã", "ãã‚‰è±†", "ã‚°ãƒªãƒ¼ãƒ³ãƒ”ãƒ¼ã‚¹", "æ–°ç”Ÿå§œ", "ã•ãã‚‰ã‚“ã¼", "ãƒ¡ãƒ­ãƒ³", "åˆé°¹", "ã‚¢ã‚¸", "ã‚¤ã‚µã‚­"],
            6: ["æ¢…", "ã‚‰ã£ãã‚‡ã†", "æ–°ç”Ÿå§œ", "ã‚ºãƒƒã‚­ãƒ¼ãƒ‹", "ã•ãã‚‰ã‚“ã¼", "ã³ã‚", "ã‚¢ã‚¸", "ã‚¤ãƒ¯ã‚·", "ç©´å­"],
            7: ["ãƒˆãƒãƒˆ", "ãã‚…ã†ã‚Š", "ãªã™", "ãƒ”ãƒ¼ãƒãƒ³", "æ¡ƒ", "ã‚¹ã‚¤ã‚«", "é°»", "ã‚¢ã‚¸", "ç©´å­", "ãƒãƒ¢"],
            8: ["ãƒˆãƒãƒˆ", "ãã‚…ã†ã‚Š", "ãªã™", "ã‚ªã‚¯ãƒ©", "æ¡ƒ", "ã‚¹ã‚¤ã‚«", "ã¶ã©ã†", "é°¹", "ã‚¢ã‚¸", "å¤ªåˆ€é­š"],
            9: ["ã•ã¤ã¾ã„ã‚‚", "é‡ŒèŠ‹", "æ —", "æ¾èŒ¸", "ã¶ã©ã†", "æ¢¨", "æŸ¿", "ç§‹åˆ€é­š", "é°¹", "é®­"],
            10: ["ã•ã¤ã¾ã„ã‚‚", "é‡ŒèŠ‹", "æ —", "æ¾èŒ¸", "æŸ¿", "ã‚Šã‚“ã”", "ç§‹åˆ€é­š", "é®­", "é¯–", "ç‰¡è £"],
            11: ["å¤§æ ¹", "ç™½èœ", "æ˜¥èŠ", "ã»ã†ã‚Œã‚“è‰", "æŸ¿", "ã¿ã‹ã‚“", "ã‚Šã‚“ã”", "ãƒ–ãƒª", "é¯–", "ç‰¡è £"],
            12: ["ç™½èœ", "ãƒã‚®", "ã»ã†ã‚Œã‚“è‰", "ã‹ã¶", "ã¿ã‹ã‚“", "ã‚†ãš", "é±ˆ", "é°¤", "ç‰¡è £", "ãµã"]
        }
        
        # å­£ç¯€ã®èŠ±ï¼ˆæœˆã”ã¨ï¼‰
        seasonal_flowers = {
            1: ("ç¦å¯¿è‰", "å¹¸ã›ã‚’æ‹›ããƒ»æ°¸ä¹…ã®å¹¸ç¦", "æ–°æ˜¥ã‚’å‘Šã’ã‚‹é»„é‡‘ã®èŠ±"),
            2: ("æ¢…", "é«˜æ½”ãƒ»å¿è€ãƒ»ç¾", "æ—©æ˜¥ã«å’²ãé¦™ã‚Šé«˜ã„èŠ±"),
            3: ("æ¡œ", "ç²¾ç¥ã®ç¾ãƒ»å„ªç¾ãªå¥³æ€§", "æ—¥æœ¬ã®æ˜¥ã‚’ä»£è¡¨ã™ã‚‹èŠ±"),
            4: ("è—¤", "æ­“è¿ãƒ»å„ªã—ã•", "ç´«ã®èŠ±æˆ¿ãŒç¾ã—ãå‚ã‚Œä¸‹ãŒã‚‹"),
            5: ("ç‰¡ä¸¹", "å¯Œè²´ãƒ»é«˜è²´", "ç™¾èŠ±ã®ç‹ã¨å‘¼ã°ã‚Œã‚‹è±ªè¯ãªèŠ±"),
            6: ("ç´«é™½èŠ±", "ç§»ã‚Šæ°—ãƒ»è¾›æŠ±å¼·ã„æ„›", "æ¢…é›¨ã‚’å½©ã‚‹è‰²å¤‰ã‚ã‚Šã®èŠ±"),
            7: ("æœé¡”", "ã¯ã‹ãªã„æ‹ãƒ»æ„›æƒ…ã®çµ†", "å¤ã®æœã‚’é£¾ã‚‹æ¶¼ã—ã’ãªèŠ±"),
            8: ("å‘æ—¥è‘µ", "æ†§ã‚Œãƒ»ã‚ãªãŸã ã‘ã‚’è¦‹ã¤ã‚ã‚‹", "å¤ªé™½ã«å‘ã‹ã£ã¦å’²ãå¤ã®èŠ±"),
            9: ("å½¼å²¸èŠ±", "å†ä¼šãƒ»æƒ…ç†±", "ç§‹ã®å½¼å²¸ã«å’²ãçœŸç´…ã®èŠ±"),
            10: ("ã‚³ã‚¹ãƒ¢ã‚¹", "èª¿å’Œãƒ»è¬™è™š", "ç§‹é¢¨ã«æºã‚Œã‚‹å¯æ†ãªèŠ±"),
            11: ("å±±èŒ¶èŠ±", "å›°é›£ã«æ‰“ã¡å‹ã¤ãƒ»ã²ãŸã‚€ãã•", "éœœã«è² ã‘ãšã«å’²ãå†¬ã®èŠ±"),
            12: ("æ°´ä»™", "è‡ªå·±æ„›ãƒ»ç¥ç§˜", "æ¸…æ¥šãªé¦™ã‚Šã®å†¬ã®èŠ±")
        }
        
        return {
            'foods': seasonal_foods.get(month, []),
            'flower': seasonal_flowers.get(month, ("å±±èŒ¶èŠ±", "å›°é›£ã«æ‰“ã¡å‹ã¤", "å†¬ã®èŠ±"))
        }
    
    def generate_content(self):
        """ãƒ–ãƒ­ã‚°æŠ•ç¨¿ç”¨ã®HTMLå½¢å¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆ - æ¯æ—¥é•ã†å†…å®¹"""
        lunar = self.get_lunar_calendar()
        sekki_kou = self.get_sekki_and_kou()
        seasonal = self.get_seasonal_info()
        
        weekday_names = ["æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ", "æ—¥"]
        weekday = weekday_names[self.target_date.weekday()]
        
        lunar_month_names = {
            1: "ç¦æœˆ", 2: "å¦‚æœˆ", 3: "å¼¥ç”Ÿ", 4: "å¯æœˆ", 5: "çšæœˆ", 6: "æ°´ç„¡æœˆ",
            7: "æ–‡æœˆ", 8: "è‘‰æœˆ", 9: "é•·æœˆ", 10: "ç¥ç„¡æœˆ", 11: "éœœæœˆ", 12: "å¸«èµ°"
        }
        
        html_content = f"""
<div style="font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif; line-height: 1.8; color: #333;">

<h2 style="color: #4a5568; border-left: 4px solid #5a67d8; padding-left: 12px;">ğŸ“… ä»Šæ—¥ã®æš¦æƒ…å ±</h2>

<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin: 20px 0; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
<p style="margin: 0; font-size: 20px;"><strong>è¥¿æš¦:</strong> {self.target_date.year}å¹´{self.target_date.month}æœˆ{self.target_date.day}æ—¥ï¼ˆ{weekday}æ›œæ—¥ï¼‰</p>
<p style="margin: 10px 0 0 0; font-size: 17px;"><strong>æ—§æš¦:</strong> {lunar['lunar_month']}æœˆ{lunar['lunar_day']}æ—¥ <span style="opacity: 0.9;">ï¼ˆ{lunar_month_names.get(lunar['lunar_month'], '')}ï¼‰</span></p>
<p style="margin: 10px 0 0 0; font-size: 17px;"><strong>æœˆé½¢:</strong> {lunar['moon_age']} <span style="opacity: 0.9;">ï¼ˆ{lunar['moon_name']}ï¼‰</span></p>
<p style="margin: 10px 0 0 0; font-size: 15px; opacity: 0.95;">ğŸŒ™ {lunar['moon_description']}</p>
</div>

<div style="background-color: #f7fafc; padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 3px solid #4299e1;">
<p style="margin: 0; color: #2d3748;">æ—§æš¦{lunar['lunar_month']}æœˆã¯<strong>ã€Œ{lunar_month_names.get(lunar['lunar_month'], '')}ã€</strong>ã€‚{lunar['moon_name']}ã®é ƒã¯ã€{lunar['moon_description']}ãŒè¦‹ã‚‰ã‚Œã‚‹å­£ç¯€ã§ã™ã€‚</p>
</div>

<hr style="border: none; border-top: 2px solid #e2e8f0; margin: 30px 0;">

<h3 style="color: #2d3748; font-size: 22px;">ğŸŒ¸ å­£ç¯€ã®èŠ±</h3>

<div style="background: linear-gradient(135deg, #ffeef8 0%, #ffe4f3 100%); padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
<p style="margin: 0; font-size: 18px; font-weight: bold; color: #831843;">ğŸŒº {seasonal['flower'][0]}</p>
<p style="margin: 10px 0 5px 0; color: #9f1239;"><em>èŠ±è¨€è‘‰:</em> <strong>{seasonal['flower'][1]}</strong></p>
<p style="margin: 5px 0 0 0; font-size: 14px; color: #be185d;">{seasonal['flower'][2]}</p>
</div>

<hr style="border: none; border-top: 2px solid #e2e8f0; margin: 30px 0;">

<div style="background: linear-gradient(135deg, #ebf8ff 0%, #dbeafe 100%); padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
<p style="margin: 0; font-size: 15px; color: #1e40af; font-weight: 500;">
ğŸƒ å­£ç¯€ã‚’æ„Ÿã˜ãªãŒã‚‰ã€ä»Šæ—¥ã‚‚è‰¯ã„ä¸€æ—¥ã‚’ãŠéã”ã—ãã ã•ã„ ğŸƒ
</p>
<p style="margin: 10px 0 0 0; font-size: 13px; color: #3b82f6;">
è‡ªå‹•æŠ•ç¨¿ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚Šç”Ÿæˆ â€¢ {self.target_date.strftime('%Yå¹´%mæœˆ%dæ—¥')}
</p>
</div>

</div>
"""
        
        return {
            'title': f'ğŸ“… {self.target_date.year}å¹´{self.target_date.month}æœˆ{self.target_date.day}æ—¥({weekday})ã®æš¦æƒ…å ±',
            'content': html_content,
            'labels': ['æš¦', 'äºŒåå››ç¯€æ°—', 'æ—§æš¦', 'å­£ç¯€', 'ä¸ƒåäºŒå€™']
        }


class BloggerPoster:
    """BloggeræŠ•ç¨¿ã‚¯ãƒ©ã‚¹"""
    
    def __init__(self):
        self.credentials = None
        self.service = None
        
    def authenticate(self):
        """Google APIã®èªè¨¼"""
        creds = None
        
        # ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èªè¨¼æƒ…å ±ã‚’å–å¾—
        if os.environ.get('GOOGLE_TOKEN'):
            token_data = json.loads(os.environ['GOOGLE_TOKEN'])
            creds = Credentials.from_authorized_user_info(token_data, SCOPES)
        
        # ãƒˆãƒ¼ã‚¯ãƒ³ãŒç„¡åŠ¹ãªå ´åˆã¯å†èªè¨¼
        if not creds or not creds.valid:
            if creds and creds.expired and creds.refresh_token:
                creds.refresh(Request())
            else:
                # åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚ã®ã¿
                if os.environ.get('GOOGLE_CREDENTIALS'):
                    creds_data = json.loads(os.environ['GOOGLE_CREDENTIALS'])
                    flow = InstalledAppFlow.from_client_config(creds_data, SCOPES)
                    creds = flow.run_local_server(port=0)
                else:
                    raise Exception("èªè¨¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
        
        self.credentials = creds
        self.service = build('blogger', 'v3', credentials=creds)
        
    def post_to_blog(self, blog_id, title, content, labels):
        """Bloggerã«æŠ•ç¨¿"""
        try:
            post = {
                'kind': 'blogger#post',
                'title': title,
                'content': content,
                'labels': labels
            }
            
            request = self.service.posts().insert(blogId=blog_id, body=post)
            response = request.execute()
            
            print(f"âœ… æŠ•ç¨¿æˆåŠŸ: {response.get('url')}")
            return response
            
        except Exception as e:
            print(f"âŒ æŠ•ç¨¿ã‚¨ãƒ©ãƒ¼: {str(e)}")
            raise


def main():
    """ãƒ¡ã‚¤ãƒ³å‡¦ç† - æ¯æ—¥å®Ÿè¡Œã•ã‚Œã‚‹"""
    try:
        # ç’°å¢ƒå¤‰æ•°ã‹ã‚‰è¨­å®šã‚’å–å¾—
        blog_id = os.environ.get('BLOG_ID')
        if not blog_id:
            raise Exception("BLOG_IDç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“")
        
        print("ğŸŒ¸ æš¦æƒ…å ±è‡ªå‹•æŠ•ç¨¿ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•")
        print(f"ğŸ“… æŠ•ç¨¿æ—¥æ™‚: {datetime.now(ZoneInfo('Asia/Tokyo')).strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M:%S')}")
        
        # æš¦æƒ…å ±ã‚’ç”Ÿæˆï¼ˆä»Šæ—¥ã®æ—¥ä»˜ã§è‡ªå‹•ç”Ÿæˆï¼‰
        print("\nğŸ“ ä»Šæ—¥ã®æš¦æƒ…å ±ã‚’ç”Ÿæˆä¸­...")
        generator = CalendarGenerator()
        post_data = generator.generate_content()
        
        print(f"   ã‚¿ã‚¤ãƒˆãƒ«: {post_data['title']}")
        
        # Bloggerã«æŠ•ç¨¿
        print("\nğŸ“¤ Bloggerã«æŠ•ç¨¿ä¸­...")
        poster = BloggerPoster()
        poster.authenticate()
        poster.post_to_blog(blog_id, post_data['title'], post_data['content'], post_data['labels'])
        
        print("\nâœ¨ ã™ã¹ã¦ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸï¼")
        print("   365æ—¥æ¯æ—¥é•ã†å†…å®¹ãŒè‡ªå‹•ã§æŠ•ç¨¿ã•ã‚Œã¾ã™ ğŸ‰")
        
    except Exception as e:
        print(f"\nğŸ’¥ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
        import traceback
        traceback.print_exc()
        sys.exit(1)


if __name__ == '__main__':
    # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ¢ãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯
    if '--setup' in sys.argv:
        print("ğŸ”§ åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ¢ãƒ¼ãƒ‰")
        print("ãƒ–ãƒ©ã‚¦ã‚¶ãŒé–‹ãã¾ã™ã€‚Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚")
        # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å‡¦ç†ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒç”¨ï¼‰
    else:
        main()

<h3 style="color: #2d3748; font-size: 22px;">â˜€ï¸ å­£ç¯€ã®ç§»ã‚ã„</h3>

<div style="border-left: 4px solid #f6ad55; padding-left: 15px; margin: 20px 0; background: linear-gradient(to right, #fef5e7, transparent); padding: 15px;">
<h4 style="color: #dd6b20; margin-top: 0; font-size: 18px;">äºŒåå››ç¯€æ°—: {sekki_kou['sekki'][0]}</h4>
<p style="margin: 5px 0 0 0; color: #2d3748;">{sekki_kou['sekki'][1]}ã€‚è‡ªç„¶ã®å¤§ããªå¤‰åŒ–ã‚’æ„Ÿã˜ã‚‹æ™‚æœŸã§ã™ã€‚</p>
</div>

<div style="border-left: 4px solid #48bb78; padding-left: 15px; margin: 20px 0; background: linear-gradient(to right, #f0fff4, transparent); padding: 15px;">
<h4 style="color: #2f855a; margin-top: 0; font-size: 18px;">ä¸ƒåäºŒå€™: {sekki_kou['kou'][0]}</h4>
<p style="margin: 5px 0; color: #2d3748;"><em>èª­ã¿:</em> {sekki_kou['kou'][1]}</p>
<p style="margin: 5px 0 0 0; color: #2d3748;">{sekki_kou['kou'][2]}ã€‚å­£ç¯€ã®å¾®ç´°ãªå¤‰åŒ–ãŒæ„Ÿã˜ã‚‰ã‚Œã¾ã™ã€‚</p>
</div>

<hr style="border: none; border-top: 2px solid #e2e8f0; margin: 30px 0;">

<h3 style="color: #2d3748; font-size: 22px;">ğŸ´ æ—¬ã®é£Ÿæ</h3>

<div style="background: linear-gradient(135deg, #fef5e7 0%, #fef3c7 100%); padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
<p style="margin: 0 0 10px 0; font-size: 16px;"><strong>ä»ŠãŒæ—¬ã®é£Ÿæ:</strong></p>
<p style="margin: 0; font-size: 15px; color: #744210;">{", ".join(seasonal['foods'][:8])}</p>
<p style="margin: 15px 0 0 0; font-size: 14px; color: #92400e;">å­£ç¯€ã®æµã¿ã‚’ã„ãŸã ãã€è‡ªç„¶ã®ãƒªã‚ºãƒ ã‚’æ„Ÿã˜ã¾ã—ã‚‡ã†ã€‚</p>
</div>

<hr style="border: none; border-top: 2px solid #e2e8f0; margin: 30px 0;">
